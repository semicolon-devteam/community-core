"use strict";var e=require("react/jsx-runtime"),t=require("react"),r=require("@supabase/supabase-js");const n=e=>{if(null==e||""===e)return"";const t=("number"==typeof e?e.toString():e).split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.length>1?t.join("."):t[0]};var o=Object.freeze({__proto__:null,formatNumberWithComma:n,removeCommaFromString:e=>e?parseFloat(e.replace(/,/g,"")):0});function s(e,t=!1){if(!e)return"";const r=new Date(e);if(isNaN(r.getTime()))return e;const n=r.getFullYear(),o=String(r.getMonth()+1).padStart(2,"0"),s=String(r.getDate()).padStart(2,"0"),i=String(r.getHours()).padStart(2,"0"),a=String(r.getMinutes()).padStart(2,"0"),l=String(r.getSeconds()).padStart(2,"0");return t?`${n}.${o}.${s}`:`${n}.${o}.${s}. ${i}:${a}:${l}`}function i(e,t=!0){if(!e)return"";const r=new Date(e);if(isNaN(r.getTime()))return e;const n=new Date,o=Math.floor((n.getTime()-r.getTime())/1e3);if(o<60)return"방금 전";const s=Math.floor(o/60);if(s<60)return`${s}분 전`;const i=Math.floor(s/60);return i<24?`${i}시간 전`:t?a.toChar(e,"MM.dd"):a.toChar(e,"yyyy.MM.dd. HH:mm:ss")}const a={toChar(e,t="YYYY.MM.DD. HH:MM:SS"){const r="string"==typeof e?new Date(e):e;if(!r||isNaN(r.getTime()))return"";const n={yyyy:String(r.getFullYear()),MM:String(r.getMonth()+1).padStart(2,"0"),dd:String(r.getDate()).padStart(2,"0"),HH:String(r.getHours()).padStart(2,"0"),mm:String(r.getMinutes()).padStart(2,"0"),ss:String(r.getSeconds()).padStart(2,"0")};return Object.entries(n).reduce((e,[t,r])=>e.replace(t,r),t)}};var l=Object.freeze({__proto__:null,DateUtil:a,formatDate:s,timeAgo:i});function c(e){return e&&"string"==typeof e.sub&&e.user_metadata}function u(e){return e&&"string"==typeof e.id&&e.nickname&&e.permissionType}const d=e=>e.level>=99||"admin"===e.permissionType||"super_admin"===e.permissionType,m=e=>!!e&&d(e),p=(e,t=0)=>{if(!e||"object"==typeof e&&0===Object.keys(e).length)return 0===t;if(m(e))return!0;if(u(e))return e.level>=t;if(c(e)){console.warn("[DEPRECATED] JWT 기반 권한 체크는 권장하지 않습니다. useAppSelector(selectUserInfo)를 사용하여 Redux store의 사용자 정보를 활용하세요.");return(e.is_admin?99:e.level||1)>=t}return e.level>=t};var g=Object.freeze({__proto__:null,checkIsAdmin:d,getUserLevel:e=>e?u(e)?e.level||0:c(e)?(console.warn("[DEPRECATED] JWT 기반 레벨 조회는 권장하지 않습니다. useAppSelector(selectUserInfo)를 사용하여 Redux store의 사용자 정보를 활용하세요."),e.is_admin?99:e.level||1):e.level||0:0,getUserPermissionType:e=>e?e.permissionType||"user":"anonymous",getUserPermissionTypeFromDB:e=>e?e.permissionType||"user":"anonymous",getUserPermissionTypeFromJWT:e=>e?e.permissionType||"user":"anonymous",hasBoardPermission:(e,t=0,r=!1)=>"free"===t||0===t||!(!r||!e)&&p(e,t),hasLevelPermission:p,isAdmin:m,isAdminOrSuperAdmin:e=>!!e&&d(e),isJWTPayload:c,isSuperAdmin:e=>!!e&&d(e),isUserObject:u,isValidUser:e=>!!e&&"string"==typeof e.id&&!!e.nickname&&!!e.permissionType});const f={sm:120,md:240,lg:480,xl:720,xxl:960};function h(e,t="md",r=70){if(!e||!e.includes("/storage/v1/object/"))return e;try{const n=e.replace("/storage/v1/object/","/storage/v1/render/image/"),o="number"==typeof t?t:f[t],s=Math.max(20,Math.min(100,r)),i=n.includes("?")?"&":"?";return`${n}${i}${`width=${o}&quality=${s}`}`}catch(t){return console.error("Failed to transform Supabase image URL:",t),e}}function y(e,t=["sm","md","lg"],r=70){const n={};return t.forEach(t=>{n[t]=h(e,t,r)}),n}function _({src:e,width:t,quality:r}){return`https://community.semi-colon.space/storage/v1/render/image/public/${e}?width=${t}&quality=${r||75}`}function x(e){if(!e||"string"!=typeof e)return e;try{const t=process.env.NEXT_PUBLIC_STORAGE_URL;if(t&&e.startsWith(t)){const r=e.replace(t,"");return r.startsWith("/")?r:`/${r}`}return e}catch(t){return console.error("Failed to normalize image src:",t),e}}function S(e,t,r){const n=x(e);return void 0!==t&&n.includes("/storage/v1/object/")?h(n,t,r):n}function E(e){if(!e||"string"!=typeof e)return!1;const t=e.toLowerCase();return t.endsWith(".gif")||t.includes(".gif?")}var b=Object.freeze({__proto__:null,IMAGE_SIZE:f,generateImageSrcSet:y,getImageProps:function(e){return E(e)?{unoptimized:!0}:{}},isAnimatedImage:function(e){return!(!e||"string"!=typeof e)&&(e.toLowerCase(),E(e))},isGifImage:E,normalizeImageSrc:x,optimizeImageSrc:S,supabaseImageLoader:_,transformSupabaseImageUrl:h});class v{static calculateUserLevel(e,t){if(!t.length)return 0;const r=[...t].sort((e,t)=>e.level-t.level);let n=0;for(const t of r){if(!(e>=t.required_points))break;n=t.level}return n}static getLevelProgress(e,t){if(!t.length)return{currentLevel:0,currentLevelPoints:0,nextLevel:1,nextLevelPoints:0,progressPercentage:0,pointsToNext:0};const r=[...t].sort((e,t)=>e.level-t.level),n=this.calculateUserLevel(e,t),o=r.find(e=>e.level===n),s=o?.required_points||0,i=r.find(e=>e.level===n+1),a=i?.level||n,l=i?.required_points||s;let c=0,u=0;if(i){const t=l-s,r=e-s;c=t>0?Math.min(100,r/t*100):100,u=Math.max(0,l-e)}else c=100,u=0;return{currentLevel:n,currentLevelPoints:s,nextLevel:a,nextLevelPoints:l,progressPercentage:Math.round(c),pointsToNext:u}}static getNextLevelInfo(e,t){if(!t.length)return{nextLevel:1,requiredPoint:0,levelUpPercentage:0,isMaxLevel:!0};const r=[...t].sort((e,t)=>e.level-t.level),n=this.calculateUserLevel(e,t),o=r.find(e=>e.level===n),s=o?.required_points||0,i=r.find(e=>e.level===n+1);if(!i)return{nextLevel:n,requiredPoint:0,levelUpPercent:100,isMaxLevel:!0};const a=i.level,l=i.required_points,c=l-s,u=e-s;return{nextLevel:a,requiredPoint:Math.max(0,l-e),levelUpPercent:c>0?Math.min(100,Math.round(u/c*100)):100,isMaxLevel:!1}}}var T=Object.freeze({__proto__:null,LevelUtil:v});const U=e=>e.replace(/_([a-z])/g,(e,t)=>t.toUpperCase()),w=e=>e.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`),O=e=>{if(null==e)return e;if(Array.isArray(e))return e.map(e=>"object"==typeof e&&null!==e?O(e):e);if("object"==typeof e){const t={};for(const[r,n]of Object.entries(e)){const e=U(r);"object"!=typeof n||null===n||Array.isArray(n)?Array.isArray(n)?t[e]=n.map(e=>"object"==typeof e&&null!==e?O(e):e):t[e]=n:t[e]=O(n)}return t}return e},A=e=>{if(null==e)return e;if(Array.isArray(e))return e.map(e=>"object"==typeof e&&null!==e?A(e):e);if("object"==typeof e){const t={};for(const[r,n]of Object.entries(e)){const e=w(r);"object"!=typeof n||null===n||Array.isArray(n)?Array.isArray(n)?t[e]=n.map(e=>"object"==typeof e&&null!==e?A(e):e):t[e]=n:t[e]=A(n)}return t}return e};var R=Object.freeze({__proto__:null,keysToCamelCase:O,keysToSnakeCase:A,toCamelCase:U,toSnakeCase:w});const I=(e,t)=>{try{const r=e.startsWith("http")?new URL(e):new URL(e,window.location.origin),n=new URLSearchParams(r.search);return Object.entries(t).forEach(([e,t])=>{n.set(e,t)}),`${r.pathname}?${n.toString()}`}catch(e){throw console.error("URL 파싱 오류:",e),new Error("유효하지 않은 URL입니다.")}},N=(e,t,r="/")=>{const n=sessionStorage.getItem(e);if(!n)return r;try{return I(n,t)}catch(e){return console.error("이전 URL 처리 오류:",e),r}};var P=Object.freeze({__proto__:null,addUrlParams:I,getPreviousUrlWithParams:N});function k(e){try{const t=e.split(".");if(3!==t.length)return console.error("Invalid JWT format"),null;const r=function(e){for(e=e.replace(/-/g,"+").replace(/_/g,"/");e.length%4;)e+="=";return decodeURIComponent(atob(e).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))}(t[1]);return JSON.parse(r)}catch(e){return console.error("JWT 디코딩 실패:",e),null}}async function C(){try{const{clientSupabase:e}=await Promise.resolve().then(function(){return V}),{data:{session:t}}=await e.auth.getSession();return t?.access_token?k(t.access_token):null}catch(e){return console.error("토큰에서 사용자 정보 추출 실패:",e),null}}function L(e){const t=Math.floor(Date.now()/1e3);return e.exp<=t}function D(e){const t=Math.floor(Date.now()/1e3);return e.exp-t}function j(e="sb-access-token"){if("undefined"!=typeof window)try{const t=document.cookie.split("; ").find(t=>t.startsWith(`${e}=`))?.split("=")[1];if(!t)return;const r=decodeURIComponent(t),n=JSON.parse(r),o=n?.access_token;if(!o)return;const s=k(o);if(s&&L(s)){console.log("🗑️ 만료된 토큰 감지, 쿠키에서 제거 중..."),document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Lax`;["supabase-auth-token","sb-auth-token","auth-token"].forEach(e=>{document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Lax`}),console.log("✅ 만료된 토큰 쿠키 제거 완료")}}catch(e){console.error("❌ 만료된 토큰 제거 중 오류:",e)}}async function M(){try{const{clientSupabase:e}=await Promise.resolve().then(function(){return V}),{data:{session:t}}=await e.auth.getSession();if(!t?.access_token)return j(),null;const r=k(t.access_token);return r?L(r)?(j(),await e.auth.signOut(),null):r:(j(),null)}catch(e){return console.error("토큰 검증 및 정리 실패:",e),j(),null}}function $(e){return D(e)<=300}var z,W=Object.freeze({__proto__:null,decodeJWTPayload:k,getCurrentUserFromToken:C,getTokenTimeToExpiry:D,isTokenExpired:L,removeExpiredTokenFromCookie:j,shouldRefreshToken:$,validateAndCleanToken:M});!function(e){e.NETWORK_ERROR="network_error",e.FILE_TOO_LARGE="file_too_large",e.UNSUPPORTED_FORMAT="unsupported_format",e.PERMISSION_DENIED="permission_denied",e.SERVER_ERROR="server_error",e.UPLOAD_TIMEOUT="upload_timeout",e.QUOTA_EXCEEDED="quota_exceeded",e.INVALID_POST="invalid_post"}(z||(z={}));const F={[z.FILE_TOO_LARGE]:"파일 크기가 너무 큽니다. 이미지는 10MB, 비디오는 100MB 이하로 업로드해주세요.",[z.UNSUPPORTED_FORMAT]:"지원하지 않는 파일 형식입니다. JPG, PNG, GIF, WebP, MP4, AVI, MOV 파일만 업로드 가능합니다.",[z.PERMISSION_DENIED]:"파일 업로드 권한이 없습니다. 로그인 상태를 확인해주세요.",[z.NETWORK_ERROR]:"네트워크 오류가 발생했습니다. 인터넷 연결을 확인하고 다시 시도해주세요.",[z.SERVER_ERROR]:"서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요.",[z.UPLOAD_TIMEOUT]:"업로드 시간이 초과되었습니다. 파일 크기를 확인하거나 다시 시도해주세요.",[z.QUOTA_EXCEEDED]:"업로드 할당량을 초과했습니다. 불필요한 파일을 삭제하거나 관리자에게 문의하세요.",[z.INVALID_POST]:"유효하지 않은 게시글입니다. 게시글을 다시 생성해주세요."};var B=Object.freeze({__proto__:null,AuthUtils:g,DateUtil:a,DateUtils:l,IMAGE_SIZE:f,ImageUtils:b,JwtUtils:W,LevelUtil:v,LevelUtils:T,NumberUtils:o,StringUtils:R,get UploadErrorType(){return z},UrlUtils:P,addUrlParams:I,calculateUploadMetrics:function(e,t){return{startTime:t,totalFiles:e.length,completedFiles:e.filter(e=>"completed"===e.status).length,failedFiles:e.filter(e=>"failed"===e.status).length,totalBytes:e.reduce((e,t)=>e+(t.fileSize||0),0),uploadedBytes:e.reduce((e,t)=>e+(t.fileSize||0)*((t.progress||0)/100),0),retryCount:0}},calculateUploadSpeed:function(e){const t=(Date.now()-e.startTime)/1e3,r=e.uploadedBytes/1048576;return t>0?r/t:0},decodeJWTPayload:k,estimateCompletionTime:function(e){const t=Date.now()-e.startTime,r=e.uploadedBytes/e.totalBytes;if(0===r)return null;const n=t/r-t;return Math.max(0,n)},formatDate:s,formatNumberWithComma:n,generateImageSrcSet:y,getCurrentUserFromToken:C,getPreviousUrlWithParams:N,getTokenTimeToExpiry:D,getUploadErrorMessage:function(e){const t=e?.message?.toLowerCase()||"",r=e?.response?.data;if(r?.error?.code){const e=r.error.code;if(F[e])return F[e]}return t.includes("file too large")||t.includes("413")?F[z.FILE_TOO_LARGE]:t.includes("unsupported")||t.includes("invalid format")||t.includes("415")?F[z.UNSUPPORTED_FORMAT]:t.includes("permission")||t.includes("unauthorized")||t.includes("401")||t.includes("403")?F[z.PERMISSION_DENIED]:t.includes("network")||t.includes("fetch")||t.includes("timeout")||"NETWORK_ERROR"===e?.code?F[z.NETWORK_ERROR]:t.includes("quota")||t.includes("storage full")||t.includes("429")?F[z.QUOTA_EXCEEDED]:t.includes("post not found")||t.includes("invalid post")||t.includes("404")?F[z.INVALID_POST]:"파일 업로드 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요."},isAdmin:m,isRetryableError:function(e){const t=e?.message?.toLowerCase()||"",r=e?.response?.data?.error?.code;return![z.FILE_TOO_LARGE,z.UNSUPPORTED_FORMAT,z.PERMISSION_DENIED,z.QUOTA_EXCEEDED,z.INVALID_POST].includes(r)&&!(t.includes("file too large")||t.includes("unsupported")||t.includes("invalid format")||t.includes("permission")||t.includes("unauthorized")||t.includes("quota"))},isTokenExpired:L,keysToCamelCase:O,keysToSnakeCase:A,logUploadError:function(e,t){const r={message:e?.message||"Unknown error",stack:e?.stack,response:e?.response?.data,context:t,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent};"development"===process.env.NODE_ENV&&(console.group("🚨 Upload Error"),console.error("Error Details:",r),console.groupEnd()),"production"===process.env.NODE_ENV&&console.error("Upload Error:",r)},normalizeImageSrc:x,optimizeImageSrc:S,removeExpiredTokenFromCookie:j,shouldRefreshToken:$,supabaseImageLoader:_,timeAgo:i,toCamelCase:U,toSnakeCase:w,transformSupabaseImageUrl:h,validateAndCleanToken:M});let q={};const J=t.forwardRef(({variant:t="primary",size:r="md",loading:n=!1,fullWidth:o=!1,startIcon:s,endIcon:i,disabled:a,className:l="",children:c,...u},d)=>{const m=["inline-flex items-center justify-center font-medium transition-colors","focus:outline-none focus:ring-2 focus:ring-offset-2","disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500",outline:"border-2 border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-gray-500",ghost:"text-gray-700 hover:bg-gray-100 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500"}[t],{sm:"px-3 py-1.5 text-sm rounded-md",md:"px-4 py-2 text-base rounded-lg",lg:"px-6 py-3 text-lg rounded-lg"}[r],o?"w-full":"",l].filter(Boolean).join(" ");return e.jsxs("button",{ref:d,className:m,disabled:a||n,...u,children:[n&&e.jsx(()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),{}),!n&&s&&e.jsx("span",{className:"mr-2",children:s}),c,!n&&i&&e.jsx("span",{className:"ml-2",children:i})]})});J.displayName="Button";const G=function(){const e=r.createClient(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storageKey:"sb-access-token",storage:{getItem:e=>{if("undefined"==typeof window)return null;try{const t=document.cookie.split("; ").find(t=>t.startsWith(`${e}=`))?.split("=")[1];if(!t)return null;const r=decodeURIComponent(t);try{const t=JSON.parse(r);t?.access_token&&import("@util/jwtUtil").then(({decodeJWTPayload:r,isTokenExpired:n,removeExpiredTokenFromCookie:o})=>{const s=r(t.access_token);s&&n(s)&&(console.log("🗑️ 클라이언트 Storage: 만료된 토큰 감지, 정리 중..."),o(e))})}catch(e){console.warn("클라이언트 Storage: 세션 데이터 파싱 실패:",e)}return r}catch(e){return console.error("❌ 클라이언트: 쿠키 읽기 실패:",e),null}},setItem:(e,t)=>{if("undefined"!=typeof window)try{if(!JSON.parse(t).access_token)return;const r=encodeURIComponent(t),n=new Date;n.setDate(n.getDate()+30),document.cookie=`${e}=${r}; expires=${n.toUTCString()}; path=/; SameSite=Lax; Secure`}catch(e){}},removeItem:e=>{if("undefined"!=typeof window)try{document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`}catch(e){}}}}});if("undefined"!=typeof window){let t=!1;e.auth.onAuthStateChange((r,n)=>{switch(r){case"SIGNED_OUT":t||(t=!0,e.auth.getSession().then(()=>{t=!1}));break;case"TOKEN_REFRESHED":break;case"USER_UPDATED":n||t||(t=!0,e.auth.signOut().then(()=>{t=!1}))}})}return e}();var V=Object.freeze({__proto__:null,clientSupabase:G});exports.Avatar=({src:r,name:n="",size:o="md",status:s,square:i=!1,className:a="",alt:l,...c})=>{const[u,d]=t.useState(!1),[m,p]=t.useState(!1),g=["inline-block relative",i?"rounded-lg":"rounded-full","bg-gray-100 overflow-hidden","ring-2 ring-white",{xs:"w-6 h-6 text-xs",sm:"w-8 h-8 text-sm",md:"w-10 h-10 text-base",lg:"w-12 h-12 text-lg",xl:"w-14 h-14 text-xl","2xl":"w-16 h-16 text-2xl"}[o]],f=r?x(r):void 0,h=[...g,a].filter(Boolean).join(" ");return e.jsxs("div",{className:h,children:[f&&!u?e.jsx("img",{src:f,alt:l||n,className:"w-full h-full object-cover",onError:()=>{d(!0)},onLoad:()=>{p(!0)},...c}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-300 text-gray-600 font-medium",children:(e=>e.split(" ").map(e=>e.charAt(0).toUpperCase()).join("").slice(0,2))(n)||"?"}),s&&e.jsx("span",{className:`absolute bottom-0 right-0 block ${{xs:"w-1.5 h-1.5",sm:"w-2 h-2",md:"w-2.5 h-2.5",lg:"w-3 h-3",xl:"w-3.5 h-3.5","2xl":"w-4 h-4"}[o]} ${{online:"bg-green-400",offline:"bg-gray-400",away:"bg-yellow-400",busy:"bg-red-400"}[s]} rounded-full ring-2 ring-white`,title:`Status: ${s}`,"aria-label":`User status: ${s}`})]})},exports.Badge=({variant:t="primary",size:r="md",rounded:n=!1,dot:o=!1,className:s="",children:i,...a})=>{const l={primary:"bg-blue-400",secondary:"bg-gray-400",success:"bg-green-400",warning:"bg-yellow-400",danger:"bg-red-400",info:"bg-indigo-400"},c=[...["inline-flex items-center font-medium",n?"rounded-full":"rounded-md"],{primary:"bg-blue-100 text-blue-800",secondary:"bg-gray-100 text-gray-800",success:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",danger:"bg-red-100 text-red-800",info:"bg-indigo-100 text-indigo-800"}[t],{sm:"px-2 py-1 text-xs",md:"px-2.5 py-1.5 text-sm",lg:"px-3 py-2 text-base"}[r],s].filter(Boolean).join(" ");return e.jsxs("span",{className:c,...a,children:[o&&e.jsx(()=>e.jsx("span",{className:`w-2 h-2 rounded-full mr-1.5 ${l[t]}`,"aria-hidden":"true"}),{}),i]})},exports.Button=J,exports.PACKAGE_NAME="@semicolon/community-core",exports.Utils=B,exports.VERSION="1.0.0",exports.formatDate=s,exports.formatNumberWithComma=n,exports.getPackageConfig=function(){return Object.freeze({...q})},exports.initializeCommunityCore=function(e){q={...q,...e},e.development&&console.log("🚀 @semicolon/community-core initialized with config:",q)},exports.isAdmin=m,exports.timeAgo=i;
//# sourceMappingURL=index.js.map
