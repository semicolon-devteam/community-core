"use strict";var e=require("react/jsx-runtime"),t=require("react"),r=require("axios");require("lodash");var s=require("@redux/Features/App/appSlice"),n=require("@redux/Features/UI/uiSlice");require("@redux/Features/Popup/popupSlice");var a=require("next/navigation"),o=require("@redux/Features/Toast/toastSlice"),i=require("@redux/Features/User/userSlice"),l=require("@util/authUtil"),c=require("@util/jwtUtil"),u=require("@services/pointService"),d=require("@tanstack/react-query"),m=require("@util/dateUtil"),p=require("@services/commentService"),h=require("@supabase/supabase-js");function g(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if("default"!==r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,Object.freeze(t)}var f=g(t);const y=e=>{if(null==e||""===e)return"";const t=("number"==typeof e?e.toString():e).split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.length>1?t.join("."):t[0]};var x=Object.freeze({__proto__:null,formatNumberWithComma:y,removeCommaFromString:e=>e?parseFloat(e.replace(/,/g,"")):0});function b(e,t=!1){if(!e)return"";const r=new Date(e);if(isNaN(r.getTime()))return e;const s=r.getFullYear(),n=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0"),o=String(r.getHours()).padStart(2,"0"),i=String(r.getMinutes()).padStart(2,"0"),l=String(r.getSeconds()).padStart(2,"0");return t?`${s}.${n}.${a}`:`${s}.${n}.${a}. ${o}:${i}:${l}`}function w(e,t=!0){if(!e)return"";const r=new Date(e);if(isNaN(r.getTime()))return e;const s=new Date,n=Math.floor((s.getTime()-r.getTime())/1e3);if(n<60)return"방금 전";const a=Math.floor(n/60);if(a<60)return`${a}분 전`;const o=Math.floor(a/60);return o<24?`${o}시간 전`:t?v.toChar(e,"MM.dd"):v.toChar(e,"yyyy.MM.dd. HH:mm:ss")}const v={toChar(e,t="YYYY.MM.DD. HH:MM:SS"){const r="string"==typeof e?new Date(e):e;if(!r||isNaN(r.getTime()))return"";const s={yyyy:String(r.getFullYear()),MM:String(r.getMonth()+1).padStart(2,"0"),dd:String(r.getDate()).padStart(2,"0"),HH:String(r.getHours()).padStart(2,"0"),mm:String(r.getMinutes()).padStart(2,"0"),ss:String(r.getSeconds()).padStart(2,"0")};return Object.entries(s).reduce((e,[t,r])=>e.replace(t,r),t)}};var S=Object.freeze({__proto__:null,DateUtil:v,formatDate:b,timeAgo:w});function k(e){return e&&"string"==typeof e.sub&&e.user_metadata}function N(e){return e&&"string"==typeof e.id&&e.nickname&&e.permissionType}const E=e=>e.level>=99||"admin"===e.permissionType||"super_admin"===e.permissionType,T=e=>!!e&&E(e),_=(e,t=0)=>{if(!e||"object"==typeof e&&0===Object.keys(e).length)return 0===t;if(T(e))return!0;if(N(e))return e.level>=t;if(k(e)){console.warn("[DEPRECATED] JWT 기반 권한 체크는 권장하지 않습니다. useAppSelector(selectUserInfo)를 사용하여 Redux store의 사용자 정보를 활용하세요.");return(e.is_admin?99:e.level||1)>=t}return e.level>=t};var P=Object.freeze({__proto__:null,checkIsAdmin:E,getUserLevel:e=>e?N(e)?e.level||0:k(e)?(console.warn("[DEPRECATED] JWT 기반 레벨 조회는 권장하지 않습니다. useAppSelector(selectUserInfo)를 사용하여 Redux store의 사용자 정보를 활용하세요."),e.is_admin?99:e.level||1):e.level||0:0,getUserPermissionType:e=>e?e.permissionType||"user":"anonymous",getUserPermissionTypeFromDB:e=>e?e.permissionType||"user":"anonymous",getUserPermissionTypeFromJWT:e=>e?e.permissionType||"user":"anonymous",hasBoardPermission:(e,t=0,r=!1)=>"free"===t||0===t||!(!r||!e)&&_(e,t),hasLevelPermission:_,isAdmin:T,isAdminOrSuperAdmin:e=>!!e&&E(e),isJWTPayload:k,isSuperAdmin:e=>!!e&&E(e),isUserObject:N,isValidUser:e=>!!e&&"string"==typeof e.id&&!!e.nickname&&!!e.permissionType});const C={sm:120,md:240,lg:480,xl:720,xxl:960};function I(e,t="md",r=70){if(!e||!e.includes("/storage/v1/object/"))return e;try{const s=e.replace("/storage/v1/object/","/storage/v1/render/image/"),n="number"==typeof t?t:C[t],a=Math.max(20,Math.min(100,r)),o=s.includes("?")?"&":"?";return`${s}${o}${`width=${n}&quality=${a}`}`}catch(t){return console.error("Failed to transform Supabase image URL:",t),e}}function U(e,t=["sm","md","lg"],r=70){const s={};return t.forEach(t=>{s[t]=I(e,t,r)}),s}function A({src:e,width:t,quality:r}){return`https://community.semi-colon.space/storage/v1/render/image/public/${e}?width=${t}&quality=${r||75}`}function M(e){if(!e||"string"!=typeof e)return e;try{const t=process.env.NEXT_PUBLIC_STORAGE_URL;if(t&&e.startsWith(t)){const r=e.replace(t,"");return r.startsWith("/")?r:`/${r}`}return e}catch(t){return console.error("Failed to normalize image src:",t),e}}function L(e,t,r){const s=M(e);return void 0!==t&&s.includes("/storage/v1/object/")?I(s,t,r):s}function O(e){if(!e||"string"!=typeof e)return!1;const t=e.toLowerCase();return t.endsWith(".gif")||t.includes(".gif?")}var $=Object.freeze({__proto__:null,IMAGE_SIZE:C,generateImageSrcSet:U,getImageProps:function(e){return O(e)?{unoptimized:!0}:{}},isAnimatedImage:function(e){return!(!e||"string"!=typeof e)&&(e.toLowerCase(),O(e))},isGifImage:O,normalizeImageSrc:M,optimizeImageSrc:L,supabaseImageLoader:A,transformSupabaseImageUrl:I});class R{static calculateUserLevel(e,t){if(!t.length)return 0;const r=[...t].sort((e,t)=>e.level-t.level);let s=0;for(const t of r){if(!(e>=t.required_points))break;s=t.level}return s}static getLevelProgress(e,t){if(!t.length)return{currentLevel:0,currentLevelPoints:0,nextLevel:1,nextLevelPoints:0,progressPercentage:0,pointsToNext:0};const r=[...t].sort((e,t)=>e.level-t.level),s=this.calculateUserLevel(e,t),n=r.find(e=>e.level===s),a=n?.required_points||0,o=r.find(e=>e.level===s+1),i=o?.level||s,l=o?.required_points||a;let c=0,u=0;if(o){const t=l-a,r=e-a;c=t>0?Math.min(100,r/t*100):100,u=Math.max(0,l-e)}else c=100,u=0;return{currentLevel:s,currentLevelPoints:a,nextLevel:i,nextLevelPoints:l,progressPercentage:Math.round(c),pointsToNext:u}}static getNextLevelInfo(e,t){if(!t.length)return{nextLevel:1,requiredPoint:0,levelUpPercentage:0,isMaxLevel:!0};const r=[...t].sort((e,t)=>e.level-t.level),s=this.calculateUserLevel(e,t),n=r.find(e=>e.level===s),a=n?.required_points||0,o=r.find(e=>e.level===s+1);if(!o)return{nextLevel:s,requiredPoint:0,levelUpPercent:100,isMaxLevel:!0};const i=o.level,l=o.required_points,c=l-a,u=e-a;return{nextLevel:i,requiredPoint:Math.max(0,l-e),levelUpPercent:c>0?Math.min(100,Math.round(u/c*100)):100,isMaxLevel:!1}}}var j=Object.freeze({__proto__:null,LevelUtil:R});const D=e=>e.replace(/_([a-z])/g,(e,t)=>t.toUpperCase()),F=e=>e.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`),B=e=>{if(null==e)return e;if(Array.isArray(e))return e.map(e=>"object"==typeof e&&null!==e?B(e):e);if("object"==typeof e){const t={};for(const[r,s]of Object.entries(e)){const e=D(r);"object"!=typeof s||null===s||Array.isArray(s)?Array.isArray(s)?t[e]=s.map(e=>"object"==typeof e&&null!==e?B(e):e):t[e]=s:t[e]=B(s)}return t}return e},z=e=>{if(null==e)return e;if(Array.isArray(e))return e.map(e=>"object"==typeof e&&null!==e?z(e):e);if("object"==typeof e){const t={};for(const[r,s]of Object.entries(e)){const e=F(r);"object"!=typeof s||null===s||Array.isArray(s)?Array.isArray(s)?t[e]=s.map(e=>"object"==typeof e&&null!==e?z(e):e):t[e]=s:t[e]=z(s)}return t}return e};var q=Object.freeze({__proto__:null,keysToCamelCase:B,keysToSnakeCase:z,toCamelCase:D,toSnakeCase:F});const W=(e,t)=>{try{const r=e.startsWith("http")?new URL(e):new URL(e,window.location.origin),s=new URLSearchParams(r.search);return Object.entries(t).forEach(([e,t])=>{s.set(e,t)}),`${r.pathname}?${s.toString()}`}catch(e){throw console.error("URL 파싱 오류:",e),new Error("유효하지 않은 URL입니다.")}},V=(e,t,r="/")=>{const s=sessionStorage.getItem(e);if(!s)return r;try{return W(s,t)}catch(e){return console.error("이전 URL 처리 오류:",e),r}};var H=Object.freeze({__proto__:null,addUrlParams:W,getPreviousUrlWithParams:V});function G(e){try{const t=e.split(".");if(3!==t.length)return console.error("Invalid JWT format"),null;const r=function(e){for(e=e.replace(/-/g,"+").replace(/_/g,"/");e.length%4;)e+="=";return decodeURIComponent(atob(e).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))}(t[1]);return JSON.parse(r)}catch(e){return console.error("JWT 디코딩 실패:",e),null}}async function J(){try{const{clientSupabase:e}=await Promise.resolve().then(function(){return rt}),{data:{session:t}}=await e.auth.getSession();return t?.access_token?G(t.access_token):null}catch(e){return console.error("토큰에서 사용자 정보 추출 실패:",e),null}}function K(e){const t=Math.floor(Date.now()/1e3);return e.exp<=t}function Q(e){const t=Math.floor(Date.now()/1e3);return e.exp-t}function Y(e="sb-access-token"){if("undefined"!=typeof window)try{const t=document.cookie.split("; ").find(t=>t.startsWith(`${e}=`))?.split("=")[1];if(!t)return;const r=decodeURIComponent(t),s=JSON.parse(r),n=s?.access_token;if(!n)return;const a=G(n);if(a&&K(a)){console.log("🗑️ 만료된 토큰 감지, 쿠키에서 제거 중..."),document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Lax`;["supabase-auth-token","sb-auth-token","auth-token"].forEach(e=>{document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Lax`}),console.log("✅ 만료된 토큰 쿠키 제거 완료")}}catch(e){console.error("❌ 만료된 토큰 제거 중 오류:",e)}}async function X(){try{const{clientSupabase:e}=await Promise.resolve().then(function(){return rt}),{data:{session:t}}=await e.auth.getSession();if(!t?.access_token)return Y(),null;const r=G(t.access_token);return r?K(r)?(Y(),await e.auth.signOut(),null):r:(Y(),null)}catch(e){return console.error("토큰 검증 및 정리 실패:",e),Y(),null}}function Z(e){return Q(e)<=300}var ee,te=Object.freeze({__proto__:null,decodeJWTPayload:G,getCurrentUserFromToken:J,getTokenTimeToExpiry:Q,isTokenExpired:K,removeExpiredTokenFromCookie:Y,shouldRefreshToken:Z,validateAndCleanToken:X});!function(e){e.NETWORK_ERROR="network_error",e.FILE_TOO_LARGE="file_too_large",e.UNSUPPORTED_FORMAT="unsupported_format",e.PERMISSION_DENIED="permission_denied",e.SERVER_ERROR="server_error",e.UPLOAD_TIMEOUT="upload_timeout",e.QUOTA_EXCEEDED="quota_exceeded",e.INVALID_POST="invalid_post"}(ee||(ee={}));const re={[ee.FILE_TOO_LARGE]:"파일 크기가 너무 큽니다. 이미지는 10MB, 비디오는 100MB 이하로 업로드해주세요.",[ee.UNSUPPORTED_FORMAT]:"지원하지 않는 파일 형식입니다. JPG, PNG, GIF, WebP, MP4, AVI, MOV 파일만 업로드 가능합니다.",[ee.PERMISSION_DENIED]:"파일 업로드 권한이 없습니다. 로그인 상태를 확인해주세요.",[ee.NETWORK_ERROR]:"네트워크 오류가 발생했습니다. 인터넷 연결을 확인하고 다시 시도해주세요.",[ee.SERVER_ERROR]:"서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요.",[ee.UPLOAD_TIMEOUT]:"업로드 시간이 초과되었습니다. 파일 크기를 확인하거나 다시 시도해주세요.",[ee.QUOTA_EXCEEDED]:"업로드 할당량을 초과했습니다. 불필요한 파일을 삭제하거나 관리자에게 문의하세요.",[ee.INVALID_POST]:"유효하지 않은 게시글입니다. 게시글을 다시 생성해주세요."};var se=Object.freeze({__proto__:null,AuthUtils:P,DateUtil:v,DateUtils:S,IMAGE_SIZE:C,ImageUtils:$,JwtUtils:te,LevelUtil:R,LevelUtils:j,NumberUtils:x,StringUtils:q,get UploadErrorType(){return ee},UrlUtils:H,addUrlParams:W,calculateUploadMetrics:function(e,t){return{startTime:t,totalFiles:e.length,completedFiles:e.filter(e=>"completed"===e.status).length,failedFiles:e.filter(e=>"failed"===e.status).length,totalBytes:e.reduce((e,t)=>e+(t.fileSize||0),0),uploadedBytes:e.reduce((e,t)=>e+(t.fileSize||0)*((t.progress||0)/100),0),retryCount:0}},calculateUploadSpeed:function(e){const t=(Date.now()-e.startTime)/1e3,r=e.uploadedBytes/1048576;return t>0?r/t:0},decodeJWTPayload:G,estimateCompletionTime:function(e){const t=Date.now()-e.startTime,r=e.uploadedBytes/e.totalBytes;if(0===r)return null;const s=t/r-t;return Math.max(0,s)},formatDate:b,formatNumberWithComma:y,generateImageSrcSet:U,getCurrentUserFromToken:J,getPreviousUrlWithParams:V,getTokenTimeToExpiry:Q,getUploadErrorMessage:function(e){const t=e?.message?.toLowerCase()||"",r=e?.response?.data;if(r?.error?.code){const e=r.error.code;if(re[e])return re[e]}return t.includes("file too large")||t.includes("413")?re[ee.FILE_TOO_LARGE]:t.includes("unsupported")||t.includes("invalid format")||t.includes("415")?re[ee.UNSUPPORTED_FORMAT]:t.includes("permission")||t.includes("unauthorized")||t.includes("401")||t.includes("403")?re[ee.PERMISSION_DENIED]:t.includes("network")||t.includes("fetch")||t.includes("timeout")||"NETWORK_ERROR"===e?.code?re[ee.NETWORK_ERROR]:t.includes("quota")||t.includes("storage full")||t.includes("429")?re[ee.QUOTA_EXCEEDED]:t.includes("post not found")||t.includes("invalid post")||t.includes("404")?re[ee.INVALID_POST]:"파일 업로드 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요."},isAdmin:T,isRetryableError:function(e){const t=e?.message?.toLowerCase()||"",r=e?.response?.data?.error?.code;return![ee.FILE_TOO_LARGE,ee.UNSUPPORTED_FORMAT,ee.PERMISSION_DENIED,ee.QUOTA_EXCEEDED,ee.INVALID_POST].includes(r)&&!(t.includes("file too large")||t.includes("unsupported")||t.includes("invalid format")||t.includes("permission")||t.includes("unauthorized")||t.includes("quota"))},isTokenExpired:K,keysToCamelCase:B,keysToSnakeCase:z,logUploadError:function(e,t){const r={message:e?.message||"Unknown error",stack:e?.stack,response:e?.response?.data,context:t,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent};"development"===process.env.NODE_ENV&&(console.group("🚨 Upload Error"),console.error("Error Details:",r),console.groupEnd()),"production"===process.env.NODE_ENV&&console.error("Upload Error:",r)},normalizeImageSrc:M,optimizeImageSrc:L,removeExpiredTokenFromCookie:Y,shouldRefreshToken:Z,supabaseImageLoader:A,timeAgo:w,toCamelCase:D,toSnakeCase:F,transformSupabaseImageUrl:I,validateAndCleanToken:X});let ne={};const ae=t.forwardRef(({variant:t="primary",size:r="md",loading:s=!1,fullWidth:n=!1,startIcon:a,endIcon:o,disabled:i,className:l="",children:c,...u},d)=>{const m=["inline-flex items-center justify-center font-medium transition-colors","focus:outline-none focus:ring-2 focus:ring-offset-2","disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500",outline:"border-2 border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-gray-500",ghost:"text-gray-700 hover:bg-gray-100 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500"}[t],{sm:"px-3 py-1.5 text-sm rounded-md",md:"px-4 py-2 text-base rounded-lg",lg:"px-6 py-3 text-lg rounded-lg"}[r],n?"w-full":"",l].filter(Boolean).join(" ");return e.jsxs("button",{ref:d,className:m,disabled:i||s,...u,children:[s&&e.jsx(()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),{}),!s&&a&&e.jsx("span",{className:"mr-2",children:a}),c,!s&&o&&e.jsx("span",{className:"ml-2",children:o})]})});ae.displayName="Button";const oe=t.forwardRef(({label:t,error:r,helper:s,type:n="text",size:a="md",fullWidth:o=!1,startAdornment:i,endAdornment:l,className:c="",containerClassName:u="",labelClassName:d="",errorClassName:m="",helperClassName:p="",disabled:h=!1,required:g=!1,id:f,...y},x)=>{const b=f||`input-${Math.random().toString(36).substr(2,9)}`,w=`\n    \n    w-full\n    font-sans\n    text-gray-900\n    bg-white\n    border\n    rounded-lg\n    transition-all\n    duration-200\n    focus:outline-none\n    focus:ring-2\n    focus:ring-blue-500/20\n    disabled:opacity-50\n    disabled:cursor-not-allowed\n    disabled:bg-gray-50\n  \n    ${{sm:"h-8 px-2 text-sm",md:"h-10 px-3 text-sm",lg:"h-12 px-4 text-base"}[a]}\n    ${r?"border-red-500 focus:border-red-500":"border-gray-300 focus:border-blue-500 hover:border-gray-400"}\n    ${i?"pl-8":""}\n    ${l?"pr-8":""}\n    ${c}\n  `.trim().replace(/\s+/g," ");return e.jsxs("div",{className:`${o?"w-full":"w-auto"} ${u}`,children:[t&&e.jsx("label",{htmlFor:b,className:`\n            block\n            text-sm\n            font-medium\n            text-gray-700\n            mb-2\n            font-sans\n            ${g?"after:content-['*'] after:text-red-500 after:ml-1":""}\n            ${h?"opacity-50":""}\n            ${d}\n          `.trim().replace(/\s+/g," "),children:t}),e.jsxs("div",{className:"relative",children:[i&&e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none",children:i}),e.jsx("input",{ref:x,id:b,type:n,disabled:h,required:g,className:w,...y}),l&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:l})]}),r&&e.jsx("p",{className:`\n          mt-2\n          text-sm\n          text-red-500\n          font-sans\n          ${m}\n        `.trim().replace(/\s+/g," "),children:r}),s&&!r&&e.jsx("p",{className:`\n          mt-2\n          text-sm\n          text-gray-500\n          font-sans\n          ${p}\n        `.trim().replace(/\s+/g," "),children:s})]})});oe.displayName="Input";const ie=t.forwardRef(({options:r,value:s,onChange:n,placeholder:a="선택해주세요",disabled:o=!1,label:i,error:l,helper:c,size:u="md",fullWidth:d=!0,multiple:m=!1,searchable:p=!1,searchPlaceholder:h="검색...",showIcon:g=!1,showDescription:f=!1,maxHeight:y="240px",noOptionsText:x="옵션이 없습니다",className:b="",dropdownClassName:w="",labelClassName:v="",errorClassName:S="",helperClassName:k=""},N)=>{const[E,T]=t.useState(!1),[_,P]=t.useState(""),C=t.useRef(null),I=`select-${Math.random().toString(36).substr(2,9)}`,U=t.useMemo(()=>m?null:r.find(e=>e.value===s),[r,s,m]);t.useEffect(()=>{const e=e=>{C.current&&!C.current.contains(e.target)&&(T(!1),P(""))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const A=`\n    \n    w-full\n    font-sans\n    bg-white\n    border\n    rounded-lg\n    transition-all\n    duration-200\n    focus:outline-none\n    focus:ring-2\n    focus:ring-blue-500/20\n    disabled:opacity-50\n    disabled:cursor-not-allowed\n    disabled:bg-gray-50\n    flex\n    items-center\n    justify-between\n    cursor-pointer\n  \n    ${{sm:"h-8 px-2 text-sm",md:"h-10 px-3 text-sm",lg:"h-12 px-4 text-base"}[u]}\n    ${l?"border-red-500 focus:border-red-500":"border-gray-300 focus:border-blue-500 hover:border-gray-400"}\n    ${b}\n  `.trim().replace(/\s+/g," ");return e.jsxs("div",{ref:N,className:(d?"w-full":"w-auto")+" relative",children:[i&&e.jsx("label",{htmlFor:I,className:`\n            block\n            text-sm\n            font-medium\n            text-gray-700\n            mb-2\n            font-sans\n            ${o?"opacity-50":""}\n            ${v}\n          `.trim().replace(/\s+/g," "),children:i}),e.jsxs("div",{ref:C,id:I,role:"button",tabIndex:o?-1:0,"aria-expanded":E,"aria-haspopup":"listbox",onClick:()=>{o||(T(!E),P(""))},className:A,children:[e.jsx("div",{className:"flex items-center gap-2 flex-1 overflow-hidden",children:U?e.jsx("span",{className:"truncate text-gray-900",children:U.label}):e.jsx("span",{className:"text-gray-500 truncate",children:a})}),e.jsx("svg",{className:"w-4 h-4 text-gray-400 transition-transform duration-200 flex-shrink-0 "+(E?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),E&&e.jsx("div",{className:`absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-50 overflow-hidden ${w}`,children:e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:y},role:"listbox",children:0===r.length?e.jsx("div",{className:"px-3 py-8 text-center text-gray-500 text-sm",children:x}):r.map(t=>{const r=t.value===s;return e.jsx("button",{type:"button",role:"option","aria-selected":r,onClick:()=>(e=>{e.disabled||(n(e),m||(T(!1),P("")))})(t),disabled:t.disabled,className:`\n                      w-full px-3 py-2 text-left flex items-center gap-2 text-sm cursor-pointer\n                      transition-colors duration-150\n                      ${t.disabled?"opacity-50 cursor-not-allowed bg-gray-50":r?"bg-blue-50 text-blue-600":"hover:bg-gray-100 text-gray-900"}\n                      border-b border-gray-100 last:border-b-0\n                    `.trim().replace(/\s+/g," "),children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"truncate",children:t.label}),f&&t.description&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 truncate",children:t.description})]})},t.id)})})}),l&&e.jsx("p",{className:`\n          mt-2\n          text-sm\n          text-red-500\n          font-sans\n          ${S}\n        `.trim().replace(/\s+/g," "),children:l}),c&&!l&&e.jsx("p",{className:`\n          mt-2\n          text-sm\n          text-gray-500\n          font-sans\n          ${k}\n        `.trim().replace(/\s+/g," "),children:c})]})});ie.displayName="Select";const le=t.forwardRef(({checked:t=!1,onChange:r,label:s,error:n,helper:a,size:o="md",indeterminate:i=!1,labelPosition:l="right",disabled:c=!1,className:u="",containerClassName:d="",labelClassName:m="",errorClassName:p="",helperClassName:h="",id:g,...f},y)=>{const x=g||`checkbox-${Math.random().toString(36).substr(2,9)}`,b=`\n    \n    text-blue-600\n    bg-white\n    border-2\n    rounded\n    transition-all\n    duration-200\n    focus:outline-none\n    focus:ring-2\n    focus:ring-blue-500/20\n    focus:border-blue-500\n    disabled:opacity-50\n    disabled:cursor-not-allowed\n    disabled:bg-gray-50\n  \n    ${{sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"}[o]}\n    ${n?"border-red-500":"border-gray-300 hover:border-blue-500"}\n    ${u}\n  `.trim().replace(/\s+/g," "),w=e.jsx("input",{ref:y,id:x,type:"checkbox",checked:t,onChange:e=>{r?.(e.target.checked,e)},disabled:c,className:b,...f}),v=s&&e.jsx("label",{htmlFor:x,className:`\n        text-gray-700\n        text-xs sm:text-sm\n        font-normal\n        font-sans\n        select-none\n        ${c?"opacity-50 cursor-not-allowed":"cursor-pointer"}\n        ${m}\n      `.trim().replace(/\s+/g," "),children:s});return e.jsxs("div",{className:d,children:[e.jsxs("div",{className:"flex items-center gap-2 "+("left"===l?"flex-row-reverse":""),children:[w,v]}),n&&e.jsx("p",{className:`\n          mt-2\n          text-sm\n          text-red-500\n          font-sans\n          ${p}\n        `.trim().replace(/\s+/g," "),children:n}),a&&!n&&e.jsx("p",{className:`\n          mt-2\n          text-sm\n          text-gray-500\n          font-sans\n          ${h}\n        `.trim().replace(/\s+/g," "),children:a})]})});le.displayName="Checkbox";const ce=t.forwardRef(({checked:t=!1,onChange:r,name:s,value:n,label:a,error:o,helper:i,size:l="md",labelPosition:c="right",disabled:u=!1,className:d="",containerClassName:m="",labelClassName:p="",errorClassName:h="",helperClassName:g="",children:f,id:y,...x},b)=>{const w=y||`radio-${Math.random().toString(36).substr(2,9)}`,v=f||a,S=e.jsxs("div",{className:"relative inline-flex items-center",children:[e.jsx("input",{ref:b,id:w,type:"radio",name:s,value:n,checked:t,onChange:e=>{r?.(e.target.value,e)},disabled:u,className:"sr-only",...x}),e.jsx("span",{className:`\n          flex-shrink-0 rounded-full flex items-center justify-center\n          border-2 transition-all duration-200\n          ${{sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"}[l]}\n          ${t?o?"border-red-500 bg-red-500":"border-blue-600 bg-blue-600":o?"border-red-500":"border-gray-300 hover:border-blue-600"}\n          ${u?"opacity-50 cursor-not-allowed":"cursor-pointer"}\n          ${d}\n        `.trim().replace(/\s+/g," "),children:e.jsx("span",{className:`\n            rounded-full transition-all duration-200 bg-white\n            ${{sm:"w-1.5 h-1.5",md:"w-2.5 h-2.5",lg:"w-3 h-3"}[l]}\n            ${t?"opacity-100 scale-100":"opacity-0 scale-50"}\n          `.trim().replace(/\s+/g," ")})})]}),k=v&&e.jsx("label",{htmlFor:w,className:`\n        text-gray-700\n        text-xs sm:text-sm\n        font-normal\n        font-sans\n        whitespace-nowrap\n        select-none\n        ${u?"opacity-50 cursor-not-allowed":"cursor-pointer"}\n        ${p}\n      `.trim().replace(/\s+/g," "),children:v});return e.jsxs("div",{className:m,children:[e.jsxs("div",{className:"inline-flex items-center gap-2 "+("left"===c?"flex-row-reverse":""),children:[S,k]}),o&&e.jsx("p",{className:`\n          mt-2\n          text-sm\n          text-red-500\n          font-sans\n          ${h}\n        `.trim().replace(/\s+/g," "),children:o}),i&&!o&&e.jsx("p",{className:`\n          mt-2\n          text-sm\n          text-gray-500\n          font-sans\n          ${g}\n        `.trim().replace(/\s+/g," "),children:i})]})});ce.displayName="Radio";const ue=t.forwardRef(({checked:t=!1,onChange:r,label:s,error:n,helper:a,size:o="md",labelPosition:i="right",onText:l,offText:c,disabled:u=!1,className:d="",containerClassName:m="",labelClassName:p="",errorClassName:h="",helperClassName:g="",id:f,...y},x)=>{const b=f||`switch-${Math.random().toString(36).substr(2,9)}`,w={sm:{track:"w-8 h-4",thumb:"w-3 h-3",translate:"translate-x-4",text:"text-xs px-1"},md:{track:"w-10 h-5",thumb:"w-4 h-4",translate:"translate-x-5",text:"text-xs px-1.5"},lg:{track:"w-12 h-6",thumb:"w-5 h-5",translate:"translate-x-6",text:"text-sm px-2"}}[o],v=`\n    relative inline-flex items-center\n    ${w.track}\n    rounded-full\n    transition-colors duration-200 ease-in-out\n    focus-within:outline-none\n    focus-within:ring-2\n    focus-within:ring-blue-500/20\n    ${t?n?"bg-red-500":"bg-blue-600":n?"bg-red-200":"bg-gray-300"}\n    ${u?"opacity-50 cursor-not-allowed":"cursor-pointer"}\n    ${d}\n  `.trim().replace(/\s+/g," "),S=`\n    inline-block\n    ${w.thumb}\n    bg-white\n    rounded-full\n    shadow\n    transform\n    transition-transform duration-200 ease-in-out\n    ${t?w.translate:"translate-x-0.5"}\n  `.trim().replace(/\s+/g," "),k=e.jsxs("div",{className:"relative inline-flex",children:[e.jsx("input",{ref:x,id:b,type:"checkbox",checked:t,onChange:e=>{r?.(e.target.checked,e)},disabled:u,className:"sr-only",...y}),e.jsxs("label",{htmlFor:b,className:v,children:[(l||c)&&e.jsx("span",{className:`\n            absolute inset-0 flex items-center justify-center\n            font-sans font-medium text-white\n            ${w.text}\n            pointer-events-none\n          `,children:t?l:c}),e.jsx("span",{className:S})]})]}),N=s&&e.jsx("label",{htmlFor:b,className:`\n        text-gray-700\n        text-xs sm:text-sm\n        font-normal\n        font-sans\n        select-none\n        ${u?"opacity-50 cursor-not-allowed":"cursor-pointer"}\n        ${p}\n      `.trim().replace(/\s+/g," "),children:s});return e.jsxs("div",{className:m,children:[e.jsxs("div",{className:"inline-flex items-center gap-3 "+("left"===i?"flex-row-reverse":""),children:[k,N]}),n&&e.jsx("p",{className:`\n          mt-2\n          text-sm\n          text-red-500\n          font-sans\n          ${h}\n        `.trim().replace(/\s+/g," "),children:n}),a&&!n&&e.jsx("p",{className:`\n          mt-2\n          text-sm\n          text-gray-500\n          font-sans\n          ${g}\n        `.trim().replace(/\s+/g," "),children:a})]})});ue.displayName="Switch";const de=t.forwardRef(({label:r,error:s,helper:n,size:a="md",fullWidth:o=!1,autoResize:i=!1,minHeight:l=80,maxHeight:c=300,maxLength:u,showCount:d=!1,disabled:m=!1,required:p=!1,className:h="",containerClassName:g="",labelClassName:f="",errorClassName:y="",helperClassName:x="",countClassName:b="",value:w,onChange:v,id:S,...k},N)=>{const E=S||`textarea-${Math.random().toString(36).substr(2,9)}`,[T,_]=t.useState(l),P=t.useCallback(e=>{if(!i)return;e.style.height="auto";const t=e.scrollHeight,r=Math.min(Math.max(t,l),c);_(r),e.style.height=`${r}px`},[i,l,c]),C=`\n    \n    w-full\n    font-sans\n    text-gray-900\n    bg-white\n    border\n    rounded-lg\n    transition-all\n    duration-200\n    focus:outline-none\n    focus:ring-2\n    focus:ring-blue-500/20\n    disabled:opacity-50\n    disabled:cursor-not-allowed\n    disabled:bg-gray-50\n    resize-none\n  \n    ${{sm:"px-2 py-1.5 text-sm",md:"px-3 py-2 text-sm",lg:"px-4 py-3 text-base"}[a]}\n    ${s?"border-red-500 focus:border-red-500":"border-gray-300 focus:border-blue-500 hover:border-gray-400"}\n    ${i?"resize-none":"resize-y"}\n    ${h}\n  `.trim().replace(/\s+/g," "),I="string"==typeof w?w.length:0,U=!!u&&I>u;return e.jsxs("div",{className:`${o?"w-full":"w-auto"} ${g}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[r&&e.jsx("label",{htmlFor:E,className:`\n              block\n              text-sm\n              font-medium\n              text-gray-700\n              font-sans\n              ${p?"after:content-['*'] after:text-red-500 after:ml-1":""}\n              ${m?"opacity-50":""}\n              ${f}\n            `.trim().replace(/\s+/g," "),children:r}),d&&(u||I>0)&&e.jsxs("span",{className:`\n            text-sm\n            font-sans\n            ${U?"text-red-500":I/(u||100)>.8?"text-orange-500":"text-gray-500"}\n            ${b}\n          `.trim().replace(/\s+/g," "),children:[I,u&&`/${u}`]})]}),e.jsx("textarea",{ref:N,id:E,value:w,onChange:e=>{u&&e.target.value.length>u||(v?.(e),i&&P(e.target))},disabled:m,required:p,maxLength:u,className:C,style:i?{height:T,minHeight:l,maxHeight:c}:{minHeight:l},...k}),e.jsxs("div",{className:"flex justify-between items-start mt-2",children:[e.jsxs("div",{className:"flex-1",children:[s&&e.jsx("p",{className:`\n              text-sm\n              text-red-500\n              font-sans\n              ${y}\n            `.trim().replace(/\s+/g," "),children:s}),n&&!s&&e.jsx("p",{className:`\n              text-sm\n              text-gray-500\n              font-sans\n              ${x}\n            `.trim().replace(/\s+/g," "),children:n})]}),d&&!r&&(u||I>0)&&e.jsxs("span",{className:`\n            text-sm\n            font-sans\n            ml-2\n            flex-shrink-0\n            ${U?"text-red-500":I/(u||100)>.8?"text-orange-500":"text-gray-500"}\n            ${b}\n          `.trim().replace(/\s+/g," "),children:[I,u&&`/${u}`]})]})]})});function me({variant:t="rectangular",width:r,height:s,animated:n=!0,light:a=!1,className:o="",style:i,...l}){const c=a?"bg-gray-100":"bg-gray-200 dark:bg-gray-700",u={...(e=>{switch(e){case"rectangular":default:return{width:r||"100%",height:s||"1.2rem"};case"circular":return{width:r||"2.5rem",height:s||r||"2.5rem"};case"rounded":return{width:r||"100%",height:s||"1.5rem"};case"text":return{width:r||"100%",height:s||"1rem"}}})(t),...i};return e.jsx("div",{className:`\n        ${c}\n        ${{rectangular:"rounded-md",circular:"rounded-full",rounded:"rounded-lg",text:"rounded-sm"}[t]}\n        ${n?"animate-pulse":""}\n        ${o}\n      `.trim().replace(/\s+/g," "),style:u,...l})}de.displayName="TextArea";const pe=({lines:t=3,className:r="",...s})=>e.jsx("div",{className:`space-y-2 ${r}`,...s,children:Array.from({length:t}).map((r,s)=>e.jsx(me,{variant:"text",width:s===t-1?"75%":"100%",height:"0.875rem"},s))}),he=({size:t="md",...r})=>{const s={sm:"2rem",md:"2.5rem",lg:"3rem",xl:"4rem"};return e.jsx(me,{variant:"circular",width:s[t],height:s[t],...r})},ge=({variant:t="md",...r})=>{const s=(e=>{switch(e){case"sm":return{width:"4rem",height:"2rem"};case"lg":return{width:"8rem",height:"3rem"};default:return{width:"6rem",height:"2.5rem"}}})(t);return e.jsx(me,{variant:"rounded",width:s.width,height:s.height,...r})},fe=process.env.NEXT_PUBLIC_API_URL,ye=r.create({baseURL:fe,timeout:36e5,headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!0});var xe,be;ye.interceptors.request.use(async e=>{if(!e.metadata?.skipLoader){e.metadata;e.metadata}if(e.data instanceof FormData&&e.headers&&delete e.headers["Content-Type"],"undefined"!=typeof window)try{const t=document.cookie.split("; ").find(e=>e.startsWith("sb-access-token="))?.split("=")[1];if(t){const r=decodeURIComponent(t),s=JSON.parse(r),n=s?.access_token;if(n){const{decodeJWTPayload:t,isTokenExpired:r,removeExpiredTokenFromCookie:s}=await Promise.resolve().then(function(){return te}),a=t(n);a&&!r(a)?e.headers&&(e.headers.Authorization=`Bearer ${n}`):(console.log("🗑️ axios 인터셉터: 만료된 토큰 감지, 쿠키에서 제거"),s())}}}catch(e){try{const{removeExpiredTokenFromCookie:e}=await Promise.resolve().then(function(){return te});e()}catch(e){console.error("JWT 유틸리티 import 실패:",e)}}return e}),ye.interceptors.response.use(async e=>{const t=e.config;if(t.metadata?.skipLoader||t.metadata,"N"===e.data?.successOrNot){const t=e.data?.statusCode,r=e.data?.message||e.data?.data;if("FORBIDDEN"===t&&"string"==typeof r&&(r.includes("해당 게시글에 접근하려면 로그인이 필요")||r.includes("로그인이 필요한 게시글")||r.includes("로그인이 필요한 게시판"))){const{clientSupabase:e}=await Promise.resolve().then(function(){return rt}),{data:{session:t}}=await e.auth.getSession();if(!t||!t.access_token){const e=new CustomEvent("auth-error",{detail:{type:"AUTH_REQUIRED",message:r}});window.dispatchEvent(e)}}}return e},async e=>{e.config;if((401===e.response?.status||403===e.response?.status)&&!e.config._retried)try{console.log("🔄 axios: 401/403 에러 감지, 토큰 갱신 시도");const{clientSupabase:t}=await Promise.resolve().then(function(){return rt}),{data:{session:r},error:s}=await t.auth.getSession();if(s||!r)throw console.error("❌ axios: 세션 확인 실패 또는 세션 없음"),new Error("세션이 유효하지 않습니다.");const{data:n,error:a}=await t.auth.refreshSession();if(a||!n.session)throw console.error("❌ axios: 토큰 갱신 실패"),new Error("토큰 갱신에 실패했습니다.");console.log("✅ axios: 토큰 갱신 성공");const o=e.config;return o._retried=!0,o.headers.Authorization=`Bearer ${n.session.access_token}`,console.log("🔄 axios: 갱신된 토큰으로 요청 재시도"),ye(o)}catch(e){console.error("❌ axios: 토큰 갱신 과정에서 오류:",e);const{clientSupabase:t}=await Promise.resolve().then(function(){return rt});await t.auth.signOut();const r=new CustomEvent("auth-error",{detail:{type:"TOKEN_INVALID"}});window.dispatchEvent(r)}return Promise.reject(e)}),function(e){e.SESSION_NAME="SESSION_NAME",e.YES_FLAG="Y",e.NO_FLAG="N",e.NA="NA"}(xe||(xe={})),function(e){e[e.SUCCESS=200]="SUCCESS",e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.FAIL=400]="FAIL",e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.FORBIDDEN=403]="FORBIDDEN",e[e.NOT_FOUND=404]="NOT_FOUND",e[e.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",e[e.BAD_GATEWAY=502]="BAD_GATEWAY",e[e.SERVICE_UNAVAILABLE=503]="SERVICE_UNAVAILABLE",e[e.GATEWAY_TIMEOUT=504]="GATEWAY_TIMEOUT"}(be||(be={}));class we{constructor(e="",t={}){this.baseUrl=e,this.defaultHeaders={"Content-Type":"application/json",...t}}handleError(e){if(e instanceof r.AxiosError){return{successOrNot:"N",statusCode:e.response?.status||be.INTERNAL_SERVER_ERROR,message:e.response?.data?.message||e.message||"An error occurred",data:null}}return{successOrNot:"N",statusCode:be.INTERNAL_SERVER_ERROR,message:e.message||"Unknown error occurred",data:null}}buildUrl(e){return e.startsWith("http")?e:`${this.baseUrl}${e.startsWith("/")?e:`/${e}`}`}prepareConfig(e){const t={headers:{...this.defaultHeaders,...e?.headers},params:e?.params,timeout:e?.timeout};return(e?.skipLoader||e?.useMiniLoader||e?.loaderText)&&(t.metadata={skipLoader:e.skipLoader,useMiniLoader:e.useMiniLoader,loaderText:e.loaderText}),t}async get(e,t){try{const r=this.buildUrl(e),s=this.prepareConfig(t);return(await ye.get(r,s)).data}catch(e){return this.handleError(e)}}async post(e,t,r){try{const s=this.buildUrl(e),n=this.prepareConfig(r);return(await ye.post(s,t,n)).data}catch(e){return this.handleError(e)}}async put(e,t,r){try{const s=this.buildUrl(e),n=this.prepareConfig(r);return(await ye.put(s,t,n)).data}catch(e){return this.handleError(e)}}async patch(e,t,r){try{const s=this.buildUrl(e),n=this.prepareConfig(r);return(await ye.patch(s,t,n)).data}catch(e){return this.handleError(e)}}async delete(e,t){try{const r=this.buildUrl(e),s=this.prepareConfig(t);return(await ye.delete(r,s)).data}catch(e){return this.handleError(e)}}async getSilent(e,t){return this.get(e,{...t,skipLoader:!0})}async postSilent(e,t,r){return this.post(e,t,{...r,skipLoader:!0})}async putSilent(e,t,r){return this.put(e,t,{...r,skipLoader:!0})}async patchSilent(e,t,r){return this.patch(e,t,{...r,skipLoader:!0})}async deleteSilent(e,t){return this.delete(e,{...t,skipLoader:!0})}async getMini(e,t,r){return this.get(e,{...r,useMiniLoader:!0,loaderText:t})}async postMini(e,t,r,s){return this.post(e,t,{...s,useMiniLoader:!0,loaderText:r})}async putMini(e,t,r,s){return this.put(e,t,{...s,useMiniLoader:!0,loaderText:r})}async patchMini(e,t,r,s){return this.patch(e,t,{...s,useMiniLoader:!0,loaderText:r})}async deleteMini(e,t,r){return this.delete(e,{...r,useMiniLoader:!0,loaderText:t})}}const ve={get:async e=>(new we).get(e),post:async(e,t)=>(new we).post(e,t),put:async(e,t)=>(new we).put(e,t),patch:async(e,t)=>(new we).patch(e,t),delete:async e=>(new we).delete(e),getSilent:async e=>(new we).getSilent(e),postSilent:async(e,t)=>(new we).postSilent(e,t),putSilent:async(e,t)=>(new we).putSilent(e,t),deleteSilent:async e=>(new we).deleteSilent(e),getMini:async(e,t)=>(new we).getMini(e,t),postMini:async(e,t,r)=>(new we).postMini(e,t,r),putMini:async(e,t,r)=>(new we).putMini(e,t,r),patchMini:async(e,t,r)=>(new we).patchMini(e,t,r),deleteMini:async(e,t)=>(new we).deleteMini(e,t)};class Se extends we{constructor(e){super(e?.baseUrl||"/api/user",e?.defaultHeaders)}async getMyInfo(){return this.getMini("/me","사용자 정보 확인중...")}async getMyPermission(){return this.get("/me/permission")}async getMyPoint(){return this.getMini("/me/point","포인트 조회중...")}async getRealtimeUser(){return this.getSilent("/realtime")}async getUserId(){return this.get("/id")}async getUserUuid(){return this.get("/uuid")}async updateUserProfile(e){return this.patch("/profile",e)}async refreshMyInfo(){return this.get("/me",{headers:{"Cache-Control":"no-cache"}})}async getUserInfo(e={}){const t={};return e.nickname&&(t.nickname=e.nickname),e.needPoint&&(t.needPoint="true"),e.includePermissions&&(t.includePermissions="true"),this.getMini("/","사용자 정보 조회중...",{params:t})}async checkUserIdExist(e){return this.post("/check/id",{userId:e})}async checkNicknameExist(e){return this.post("/check/nickname",{nickname:e})}async getUserById(e){return this.get(`/${e}`)}async getUsersByIds(e){return this.post("/batch",{userIds:e})}async searchUsers(e,t=1,r=10){return this.get("/search",{params:{keyword:e,page:t,pageSize:r}})}async updateUserLevel(e,t){return this.patch(`/${e}/level`,{level:t})}async updateUserBanStatus(e,t,r){return this.patch(`/${e}/ban-status`,{isBanned:t,reason:r})}}const ke={getMyInfo:()=>(new Se).getMyInfo(),getMyPermission:()=>(new Se).getMyPermission(),getMyPoint:()=>(new Se).getMyPoint(),getRealtimeUser:()=>(new Se).getRealtimeUser(),getUserId:()=>(new Se).getUserId(),getUserUuid:()=>(new Se).getUserUuid(),updateUserProfile:e=>(new Se).updateUserProfile({profileImage:e}),refreshMyInfo:()=>(new Se).refreshMyInfo(),getUserInfo:(e,t=!1)=>(new Se).getUserInfo({nickname:e,needPoint:t}),checkUserIdExist:e=>(new Se).checkUserIdExist(e),checkNicknameExist:e=>(new Se).checkNicknameExist(e)};class Ne extends we{constructor(e){super(e?.baseUrl||"/api/post",e?.defaultHeaders)}async getPostList(e){const t={boardId:e.boardId.toString(),page:e.page.toString(),pageSize:(e.pageSize||10).toString(),sortBy:e.sortBy||"latest",searchType:e.searchType||"title",searchText:e.searchText||"",needNotice:(!1!==e.needNotice).toString()};return void 0!==e.categoryId&&null!==e.categoryId&&""!==e.categoryId&&(t.categoryId=e.categoryId.toString()),e.status&&(t.status=e.status),e.writerId&&(t.writerId=e.writerId.toString()),this.getMini("/","게시글 목록 로딩중...",{params:t})}async getPostById(e){return this.get(`/${e}`)}async createPost(e){const t=new FormData;return t.append("title",e.title),t.append("content",e.content),t.append("boardId",e.boardId.toString()),t.append("isNotice",(e.isNotice||!1).toString()),t.append("hasFiles",(e.hasFiles||!1).toString()),null!==e.categoryId&&void 0!==e.categoryId&&t.append("categoryId",e.categoryId.toString()),void 0!==e.downloadPoint&&null!==e.downloadPoint&&t.append("downloadPoint",e.downloadPoint.toString()),e.attachments&&e.attachments.length>0&&t.append("attachments",JSON.stringify(e.attachments)),e.metadata&&t.append("metadata",JSON.stringify(e.metadata)),e.files&&e.files.length>0&&e.files.forEach(e=>{t.append("files",e)}),this.postMini(`/${e.boardId}`,t,"게시글 등록중...")}async updatePost(e,t){return this.putMini(`/${e}`,t,"게시글 수정중...")}async deletePost(e){return this.deleteMini(`/${e}`,"게시글 삭제중...")}async reactToPost(e,t){const r="like"===t?"추천 처리중...":"비추천 처리중...";return this.postMini(`/${e}/reaction`,{reactionType:t},r)}async purchaseFiles(e){return this.postMini(`/${e}/purchase`,{},"파일 구매 처리중...")}async bookmarkPost(e){return this.postMini(`/${e}/bookmark`,{},"북마크 처리중...")}async removeBookmark(e){return this.deleteMini(`/${e}/bookmark`,"북마크 삭제중...")}async getBookmarkedPosts(){return this.getMini("/bookmarks","북마크된 게시글 불러오는 중...")}async movePost(e,t){return this.patchMini(`/${e}`,{board_id:t},"게시글 이동중...")}async createDraftPost(e){return this.postMini("/draft",e,"게시글 초안 생성중...")}async publishPost(e){return this.putMini(`/${e}/publish`,{},"게시글 발행중...")}async startAsyncFileUpload(e,t,r){const s=new FormData;s.append("postId",e.toString()),s.append("needWatermark",(!1!==r?.needWatermark).toString()),s.append("watermarkPosition",r?.watermarkPosition||"bottom-right"),s.append("watermarkOpacity",(r?.watermarkOpacity||.7).toString()),t.forEach(e=>{s.append("files",e)});const n=await this.postMini("/upload-async",s,"파일 업로드 시작중...");if(n.data&&!n.data.success)throw new Error(n.data.message);return{...n,data:n.data?.data||null}}async getUploadProgress(e){const t=await this.getSilent(`/upload-progress/${e}`);if(t.data&&!t.data.success)throw new Error(t.data.message||"진행도 조회에 실패했습니다");return{...t,data:t.data?.data||null}}async retryFailedFiles(e,t){return this.postMini(`/retry-upload/${e}`,{failedFileUuids:t},"실패한 파일 재업로드 중...")}async cancelUpload(e){return this.deleteMini(`/cancel-upload/${e}`,"업로드 취소중...")}async createPostAsync(e){const t=await this.createDraftPost({title:e.title,content:e.content,boardId:e.boardId,categoryId:e.categoryId||void 0});return"Y"===t.successOrNot&&t.data?(e.files&&e.files.length>0?await this.startAsyncFileUpload(t.data.id,e.files):await this.publishPost(t.data.id),t):t}async getDraftPosts(e={}){const t={status:"draft",page:(e.page||1).toString(),pageSize:(e.pageSize||10).toString(),sortBy:e.sortBy||"latest"};return e.writerId&&(t.writerId=e.writerId.toString()),this.getSilent("/",{params:t})}async searchPosts(e,t=1,r=10,s){const n={keyword:e,page:t.toString(),pageSize:r.toString()};return s&&s.length>0&&(n.boardIds=s.join(",")),this.get("/search",{params:n})}async getPostStats(e){const t=e?{boardId:e.toString()}:{};return this.get("/stats",{params:t})}}const Ee={getPost:e=>(new Ne).getPostList(e),createPost:e=>(new Ne).createPost(e),reactionPost:(e,t)=>(new Ne).reactToPost(e,t),deletePost:e=>(new Ne).deletePost(e),updatePost:(e,t)=>(new Ne).updatePost(e,t),purchaseFiles:e=>(new Ne).purchaseFiles(e),bookmarkPost:e=>(new Ne).bookmarkPost(e),deleteBookmarkPost:e=>(new Ne).removeBookmark(e),getBookmarkPosts:()=>(new Ne).getBookmarkedPosts(),movePost:(e,t)=>(new Ne).movePost(e,t),createDraftPost:e=>(new Ne).createDraftPost(e),publishPost:e=>(new Ne).publishPost(e),getDraftPosts:(e={})=>(new Ne).getDraftPosts(e),startAsyncFileUpload:(e,t,r)=>(new Ne).startAsyncFileUpload(e,t,r),getUploadProgress:e=>(new Ne).getUploadProgress(e),retryFailedFiles:(e,t)=>(new Ne).retryFailedFiles(e,t),cancelUpload:e=>(new Ne).cancelUpload(e),createPostAsync:e=>(new Ne).createPostAsync(e)};class Te extends we{constructor(e){super(e?.baseUrl||"/api/boards",e?.defaultHeaders)}async getBoards(e={}){const t={};return e.page&&(t.page=e.page.toString()),e.pageSize&&(t.pageSize=e.pageSize.toString()),e.sortBy&&(t.sortBy=e.sortBy),e.searchText&&(t.searchText=e.searchText),e.searchType&&(t.searchType=e.searchType),void 0!==e.isActive&&(t.isActive=e.isActive.toString()),e.categoryId&&(t.categoryId=e.categoryId.toString()),this.getMini("/","게시판 목록 로딩중...",{params:t})}async getBoard(e){return this.getMini(`/${e}`,"게시판 정보 로딩중...")}async createBoard(e){return this.postMini("/",e,"게시판 생성중...")}async updateBoard(e,t){return this.putMini(`/${e}`,t,"게시판 수정중...")}async deleteBoard(e){return this.deleteMini(`/${e}`,"게시판 삭제중...")}async getBoardCategories(e){return this.getMini(`/${e}/categories`,"카테고리 로딩중...")}async createBoardCategory(e,t){return this.postMini(`/${e}/categories`,t,"카테고리 생성중...")}async updateBoardCategory(e,t,r){return this.putMini(`/${e}/categories/${t}`,r,"카테고리 수정중...")}async deleteBoardCategory(e,t){return this.deleteMini(`/${e}/categories/${t}`,"카테고리 삭제중...")}async getBoardStats(e){return this.getSilent(`/${e}/stats`)}async searchBoards(e,t=1,r=10){return this.get("/search",{params:{keyword:e,page:t.toString(),pageSize:r.toString()}})}async getPopularBoards(e=10){return this.getSilent("/popular",{params:{limit:e.toString()}})}async getRecentlyActiveBoards(e=10){return this.getSilent("/recent-activity",{params:{limit:e.toString()}})}async getFavoriteBoards(){return this.getMini("/favorites","즐겨찾기 게시판 로딩중...")}async addToFavorites(e){return this.postMini(`/${e}/favorite`,{},"즐겨찾기 추가중...")}async removeFromFavorites(e){return this.deleteMini(`/${e}/favorite`,"즐겨찾기 제거중...")}async getBoardPermissions(e){return this.getSilent(`/${e}/permissions`)}async updateBoardPermissions(e,t){return this.patchMini(`/${e}/permissions`,t,"권한 설정 업데이트 중...")}async getBoardModerators(e){return this.get(`/${e}/moderators`)}async addBoardModerator(e,t){return this.postMini(`/${e}/moderators`,{userId:t},"모더레이터 추가중...")}async removeBoardModerator(e,t){return this.deleteMini(`/${e}/moderators/${t}`,"모더레이터 제거중...")}async reportBoard(e,t,r){return this.postMini(`/${e}/report`,{reason:t,description:r},"신고 접수중...")}async getBoardActivity(e,t=1,r=20){return this.get(`/${e}/activity`,{params:{page:t.toString(),pageSize:r.toString()}})}}const _e={getBoards:()=>(new Te).getBoards(),getBoard:e=>(new Te).getBoard(e),getBoardCategories:e=>(new Te).getBoardCategories(e)};class Pe extends we{constructor(e){super(e?.baseUrl||"/api/auth",e?.defaultHeaders)}async login(e){return this.postMini("/login",e,"로그인 중...")}async logout(){return this.postMini("/logout",{},"로그아웃 중...")}async register(e){return this.postMini("/register",e,"회원가입 처리 중...")}async refreshToken(e){return this.postSilent("/refresh",{refreshToken:e})}async validateSession(){return this.getSilent("/validate")}async getCurrentUser(){return this.getMini("/me","사용자 정보 확인 중...")}async requestPasswordReset(e){return this.postMini("/password-reset/request",e,"비밀번호 재설정 요청 중...")}async resetPassword(e,t,r){return this.postMini("/password-reset/confirm",{token:e,newPassword:t,newPasswordConfirm:r},"비밀번호 재설정 중...")}async changePassword(e){return this.putMini("/password",e,"비밀번호 변경 중...")}async sendEmailVerification(e){return this.postMini("/verify-email/send",{email:e},"인증 메일 발송 중...")}async verifyEmail(e){return this.postMini("/verify-email/confirm",{token:e},"이메일 인증 중...")}async checkUserIdAvailability(e){return this.get("/check/userid",{params:{userId:e}})}async checkNicknameAvailability(e){return this.get("/check/nickname",{params:{nickname:e}})}async checkEmailAvailability(e){return this.get("/check/email",{params:{email:e}})}async getUserSessions(){return this.get("/sessions")}async revokeSession(e){return this.deleteMini(`/sessions/${e}`,"세션 해제 중...")}async revokeAllSessions(){return this.deleteMini("/sessions/all","모든 세션 해제 중...")}async enable2FA(){return this.postMini("/2fa/enable",{},"2FA 설정 중...")}async confirm2FA(e){return this.postMini("/2fa/confirm",{code:e},"2FA 인증 중...")}async disable2FA(e){return this.deleteMini("/2fa/disable","2FA 해제 중...")}async verify2FACode(e){return this.postMini("/2fa/verify",{code:e},"2FA 코드 확인 중...")}}const Ce={login:e=>(new Pe).login(e),logout:()=>(new Pe).logout(),register:e=>(new Pe).register(e),refreshToken:e=>(new Pe).refreshToken(e),validateSession:()=>(new Pe).validateSession(),getCurrentUser:()=>(new Pe).getCurrentUser(),requestPasswordReset:e=>(new Pe).requestPasswordReset(e),resetPassword:(e,t,r)=>(new Pe).resetPassword(e,t,r),changePassword:e=>(new Pe).changePassword(e),sendEmailVerification:e=>(new Pe).sendEmailVerification(e),verifyEmail:e=>(new Pe).verifyEmail(e),checkUserIdAvailability:e=>(new Pe).checkUserIdAvailability(e),checkNicknameAvailability:e=>(new Pe).checkNicknameAvailability(e),checkEmailAvailability:e=>(new Pe).checkEmailAvailability(e)};class Ie extends we{constructor(e){super(e?.baseUrl||"/api/permissions",e?.defaultHeaders)}async checkPermission(e){return this.getSilent("/check",{params:{resource:e.resource,action:e.action,context:e.context?JSON.stringify(e.context):void 0}})}async checkPermissions(e){return this.postSilent("/check-multiple",{checks:e})}async getMyPermissions(){return this.getMini("/me","권한 정보 조회 중...")}async getUserPermissions(e){return this.get(`/users/${e}`)}async getLevels(){return this.getSilent("/levels")}async getLevel(e){return this.get(`/levels/${e}`)}async updateUserLevel(e,t,r){return this.patchMini(`/users/${e}/level`,{level:t,reason:r},"사용자 레벨 변경 중...")}async getRoles(){return this.get("/roles")}async getRole(e){return this.get(`/roles/${e}`)}async createRole(e){return this.postMini("/roles",e,"역할 생성 중...")}async updateRole(e,t){return this.putMini(`/roles/${e}`,t,"역할 수정 중...")}async deleteRole(e){return this.deleteMini(`/roles/${e}`,"역할 삭제 중...")}async assignRole(e,t,r){return this.postMini(`/users/${e}/roles`,{roleId:t,reason:r},"역할 할당 중...")}async removeRole(e,t,r){return this.deleteMini(`/users/${e}/roles/${t}`,"역할 제거 중...")}async grantPermission(e){return this.postMini("/grants",e,"권한 부여 중...")}async revokePermission(e,t,r,s){return this.deleteMini(`/grants/${e}/${t}`,"권한 회수 중...")}async getUserGrants(e){return this.get(`/grants/users/${e}`)}async getPermissionHistory(e,t=1,r=20){return this.get(`/history/${e}`,{params:{page:t.toString(),pageSize:r.toString()}})}async checkBoardAccess(e,t="read"){return this.checkPermission({resource:"board",action:t,context:{boardId:e}})}async checkPostAccess(e,t="read"){return this.checkPermission({resource:"post",action:t,context:{postId:e}})}async checkAdminAccess(e="system"){return this.checkPermission({resource:"admin",action:"access",context:{section:e}})}async getLevelProgression(e){const t=e?`/progression/${e}`:"/progression/me";return this.getMini(t,"레벨 정보 조회 중...")}async updateUserBanStatus(e,t,r,s){return this.patchMini(`/users/${e}/ban`,{banned:t,reason:r,duration:s},t?"사용자 제재 중...":"사용자 제재 해제 중...")}async getUserRestrictions(e){return this.get(`/users/${e}/restrictions`)}}const Ue={checkPermission:e=>(new Ie).checkPermission(e),getMyPermissions:()=>(new Ie).getMyPermissions(),getLevels:()=>(new Ie).getLevels(),checkBoardAccess:(e,t="read")=>(new Ie).checkBoardAccess(e,t),checkAdminAccess:(e="system")=>(new Ie).checkAdminAccess(e)};var Ae,Me={exports:{}},Le={};var Oe,$e={};
/**
 * @license React
 * use-sync-external-store-with-selector.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */"production"===process.env.NODE_ENV?Me.exports=function(){if(Ae)return Le;Ae=1;var e=t,r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=e.useSyncExternalStore,n=e.useRef,a=e.useEffect,o=e.useMemo,i=e.useDebugValue;return Le.useSyncExternalStoreWithSelector=function(e,t,l,c,u){var d=n(null);if(null===d.current){var m={hasValue:!1,value:null};d.current=m}else m=d.current;d=o(function(){function e(e){if(!a){if(a=!0,s=e,e=c(e),void 0!==u&&m.hasValue){var t=m.value;if(u(t,e))return n=t}return n=e}if(t=n,r(s,e))return t;var o=c(e);return void 0!==u&&u(t,o)?(s=e,t):(s=e,n=o)}var s,n,a=!1,o=void 0===l?null:l;return[function(){return e(t())},null===o?void 0:function(){return e(o())}]},[t,l,c,u]);var p=s(e,d[0],d[1]);return a(function(){m.hasValue=!0,m.value=p},[p]),i(p),p},Le}():Me.exports=(Oe||(Oe=1,"production"!==process.env.NODE_ENV&&function(){"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var e=t,r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=e.useSyncExternalStore,n=e.useRef,a=e.useEffect,o=e.useMemo,i=e.useDebugValue;$e.useSyncExternalStoreWithSelector=function(e,t,l,c,u){var d=n(null);if(null===d.current){var m={hasValue:!1,value:null};d.current=m}else m=d.current;d=o(function(){function e(e){if(!a){if(a=!0,s=e,e=c(e),void 0!==u&&m.hasValue){var t=m.value;if(u(t,e))return n=t}return n=e}if(t=n,r(s,e))return t;var o=c(e);return void 0!==u&&u(t,o)?(s=e,t):(s=e,n=o)}var s,n,a=!1,o=void 0===l?null:l;return[function(){return e(t())},null===o?void 0:function(){return e(o())}]},[t,l,c,u]);var p=s(e,d[0],d[1]);return a(function(){m.hasValue=!0,m.value=p},[p]),i(p),p},"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()),$e);var Re=Me.exports,je=Symbol.for("react-redux-context"),De="undefined"!=typeof globalThis?globalThis:{};function Fe(){if(!f.createContext)return{};const e=De[je]??=new Map;let t=e.get(f.createContext);return t||(t=f.createContext(null),"production"!==process.env.NODE_ENV&&(t.displayName="ReactRedux"),e.set(f.createContext,t)),t}var Be=Fe();function ze(e=Be){return function(){const t=f.useContext(e);if("production"!==process.env.NODE_ENV&&!t)throw new Error("could not find react-redux context value; please ensure the component is wrapped in a <Provider>");return t}}var qe=ze();function We(e=Be){const t=e===Be?qe:ze(e),r=()=>{const{store:e}=t();return e};return Object.assign(r,{withTypes:()=>r}),r}var Ve=We();function He(e=Be){const t=e===Be?Ve:We(e),r=()=>t().dispatch;return Object.assign(r,{withTypes:()=>r}),r}var Ge=He(),Je=(e,t)=>e===t;function Ke(e=Be){const t=e===Be?qe:ze(e),r=(e,r={})=>{const{equalityFn:s=Je}="function"==typeof r?{equalityFn:r}:r;if("production"!==process.env.NODE_ENV){if(!e)throw new Error("You must pass a selector to useSelector");if("function"!=typeof e)throw new Error("You must pass a function as a selector to useSelector");if("function"!=typeof s)throw new Error("You must pass a function as an equality function to useSelector")}const n=t(),{store:a,subscription:o,getServerState:i}=n,l=f.useRef(!0),c=f.useCallback({[e.name](t){const a=e(t);if("production"!==process.env.NODE_ENV){const{devModeChecks:o={}}="function"==typeof r?{}:r,{identityFunctionCheck:i,stabilityCheck:c}=n,{identityFunctionCheck:u,stabilityCheck:d}={stabilityCheck:c,identityFunctionCheck:i,...o};if("always"===d||"once"===d&&l.current){const r=e(t);if(!s(a,r)){let s;try{throw new Error}catch(e){({stack:s}=e)}console.warn("Selector "+(e.name||"unknown")+" returned a different result when called with the same parameters. This can lead to unnecessary rerenders.\nSelectors that return a new reference (such as an object or an array) should be memoized: https://redux.js.org/usage/deriving-data-selectors#optimizing-selectors-with-memoization",{state:t,selected:a,selected2:r,stack:s})}}if(("always"===u||"once"===u&&l.current)&&a===t){let t;try{throw new Error}catch(e){({stack:t}=e)}console.warn("Selector "+(e.name||"unknown")+" returned the root state when called. This can lead to unnecessary rerenders.\nSelectors that return the entire state are almost certainly a mistake, as they will cause a rerender whenever *anything* in state changes.",{stack:t})}l.current&&(l.current=!1)}return a}}[e.name],[e]),u=Re.useSyncExternalStoreWithSelector(o.addNestedSub,a.getState,i||a.getState,c,s);return f.useDebugValue(u),u};return Object.assign(r,{withTypes:()=>r}),r}var Qe=Ke();const Ye=()=>{const e=Ze(),{isAutoTransitioned:r}=et(n.selectUIState),s=t.useCallback(t=>{e(n.showMiniLoading(t))},[e]),a=t.useCallback(()=>{e(n.hideMiniLoading())},[e]),o=t.useCallback(t=>{e(n.setMiniLoadingText(t))},[e]),i=t.useCallback(async e=>{try{s();return await e()}finally{a()}},[s,a]),l=t.useCallback(t=>{e(n.showLoading(t))},[e]),c=t.useCallback(()=>{e(r?n.hideAllLoaders():n.hideLoading())},[e,r]),u=t.useCallback(t=>{e(n.setLoadingText(t))},[e]),d=t.useCallback(async e=>{try{l();return await e()}finally{c()}},[l,c]),m=t.useCallback(t=>{e(n.showMiniLoading(t))},[e]),p=t.useCallback(()=>{e(n.hideMiniLoading())},[e]),h=t.useCallback(t=>{e(n.setMiniLoadingText(t))},[e]),g=t.useCallback(async e=>{try{m();return await e()}finally{p()}},[m,p]);return{showLoader:s,hideLoader:a,withLoader:i,setLoaderText:o,showPostLoader:l,hidePostLoader:c,withPostLoader:d,setPostLoaderText:u,showMiniLoader:m,hideMiniLoader:p,withMiniLoader:g,setMiniLoaderText:h}},Xe=()=>{const e=a.useRouter(),r=a.usePathname(),{showMiniLoader:s,hideMiniLoader:n}=Ye();t.useEffect(()=>{n()},[r,n]);const o=t.useCallback(e=>{try{let t,s=!1;if(e.startsWith("http")){const r=new URL(e),n=window.location.hostname;s=r.hostname!==n,t=r.pathname}else t=e.split("?")[0].split("#")[0];return!s&&t!==r}catch{return!e.startsWith("http")}},[r]),i=t.useCallback((t,r)=>(o(t)&&s("페이지를 이동하는 중입니다."),e.push(t,r)),[e,s,o]),l=t.useCallback((t,r)=>(o(t)&&s("페이지를 이동하는 중입니다."),e.replace(t,r)),[e,s,o]);return{...e,push:i,replace:l}},Ze=()=>Ge(),et=Qe;const tt=function(){const e=h.createClient(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storageKey:"sb-access-token",storage:{getItem:e=>{if("undefined"==typeof window)return null;try{const t=document.cookie.split("; ").find(t=>t.startsWith(`${e}=`))?.split("=")[1];if(!t)return null;const r=decodeURIComponent(t);try{const t=JSON.parse(r);t?.access_token&&Promise.resolve().then(function(){return te}).then(({decodeJWTPayload:r,isTokenExpired:s,removeExpiredTokenFromCookie:n})=>{const a=r(t.access_token);a&&s(a)&&(console.log("🗑️ 클라이언트 Storage: 만료된 토큰 감지, 정리 중..."),n(e))})}catch(e){console.warn("클라이언트 Storage: 세션 데이터 파싱 실패:",e)}return r}catch(e){return console.error("❌ 클라이언트: 쿠키 읽기 실패:",e),null}},setItem:(e,t)=>{if("undefined"!=typeof window)try{if(!JSON.parse(t).access_token)return;const r=encodeURIComponent(t),s=new Date;s.setDate(s.getDate()+30),document.cookie=`${e}=${r}; expires=${s.toUTCString()}; path=/; SameSite=Lax; Secure`}catch(e){}},removeItem:e=>{if("undefined"!=typeof window)try{document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`}catch(e){}}}}});if("undefined"!=typeof window){let t=!1;e.auth.onAuthStateChange((r,s)=>{switch(r){case"SIGNED_OUT":t||(t=!0,e.auth.getSession().then(()=>{t=!1}));break;case"TOKEN_REFRESHED":break;case"USER_UPDATED":s||t||(t=!0,e.auth.signOut().then(()=>{t=!1}))}})}return e}();var rt=Object.freeze({__proto__:null,clientSupabase:tt});exports.AuthService=Pe,exports.Avatar=({src:r,name:s="",size:n="md",status:a,square:o=!1,className:i="",alt:l,...c})=>{const[u,d]=t.useState(!1),[m,p]=t.useState(!1),h=["inline-block relative",o?"rounded-lg":"rounded-full","bg-gray-100 overflow-hidden","ring-2 ring-white",{xs:"w-6 h-6 text-xs",sm:"w-8 h-8 text-sm",md:"w-10 h-10 text-base",lg:"w-12 h-12 text-lg",xl:"w-14 h-14 text-xl","2xl":"w-16 h-16 text-2xl"}[n]],g=r?M(r):void 0,f=[...h,i].filter(Boolean).join(" ");return e.jsxs("div",{className:f,children:[g&&!u?e.jsx("img",{src:g,alt:l||s,className:"w-full h-full object-cover",onError:()=>{d(!0)},onLoad:()=>{p(!0)},...c}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-300 text-gray-600 font-medium",children:(e=>e.split(" ").map(e=>e.charAt(0).toUpperCase()).join("").slice(0,2))(s)||"?"}),a&&e.jsx("span",{className:`absolute bottom-0 right-0 block ${{xs:"w-1.5 h-1.5",sm:"w-2 h-2",md:"w-2.5 h-2.5",lg:"w-3 h-3",xl:"w-3.5 h-3.5","2xl":"w-4 h-4"}[n]} ${{online:"bg-green-400",offline:"bg-gray-400",away:"bg-yellow-400",busy:"bg-red-400"}[a]} rounded-full ring-2 ring-white`,title:`Status: ${a}`,"aria-label":`User status: ${a}`})]})},exports.Badge=({variant:t="primary",size:r="md",rounded:s=!1,dot:n=!1,className:a="",children:o,...i})=>{const l={primary:"bg-blue-400",secondary:"bg-gray-400",success:"bg-green-400",warning:"bg-yellow-400",danger:"bg-red-400",info:"bg-indigo-400"},c=[...["inline-flex items-center font-medium",s?"rounded-full":"rounded-md"],{primary:"bg-blue-100 text-blue-800",secondary:"bg-gray-100 text-gray-800",success:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",danger:"bg-red-100 text-red-800",info:"bg-indigo-100 text-indigo-800"}[t],{sm:"px-2 py-1 text-xs",md:"px-2.5 py-1.5 text-sm",lg:"px-3 py-2 text-base"}[r],a].filter(Boolean).join(" ");return e.jsxs("span",{className:c,...i,children:[n&&e.jsx(()=>e.jsx("span",{className:`w-2 h-2 rounded-full mr-1.5 ${l[t]}`,"aria-hidden":"true"}),{}),o]})},exports.BaseService=we,exports.BoardService=Te,exports.Button=ae,exports.Checkbox=le,exports.Input=oe,exports.PACKAGE_NAME="@team-semicolon/community-core",exports.PermissionService=Ie,exports.PostService=Ne,exports.Radio=ce,exports.Select=ie,exports.Skeleton=me,exports.SkeletonAvatar=he,exports.SkeletonButton=ge,exports.SkeletonCard=({...t})=>e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg space-y-4",...t,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(he,{size:"md"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(me,{variant:"text",width:"60%"}),e.jsx(me,{variant:"text",width:"40%"})]})]}),e.jsx(pe,{lines:3}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(ge,{variant:"sm"}),e.jsx(ge,{variant:"sm"})]})]}),exports.SkeletonText=pe,exports.Switch=ue,exports.TextArea=de,exports.UserService=Se,exports.Utils=se,exports.VERSION="1.3.0",exports.authService=Ce,exports.baseService=ve,exports.boardService=_e,exports.formatDate=b,exports.formatNumberWithComma=y,exports.getPackageConfig=function(){return Object.freeze({...ne})},exports.initializeCommunityCore=function(e){ne={...ne,...e},e.development&&console.log("🚀 @semicolon/community-core initialized with config:",ne)},exports.isAdmin=T,exports.permissionService=Ue,exports.postService=Ee,exports.timeAgo=w,exports.useAuth=()=>{const e=Ze(),r=et(i.selectUserInfo),{withLoader:s,showLoader:n,hideLoader:a}=Ye(),l=Xe(),c=t.useCallback(async t=>s(async()=>{const r=await e(i.login(t));if(i.login.fulfilled.match(r))return e(o.showToast({title:"로그인 성공",content:`환영합니다, ${r.payload.nickname}님!`,headerTextColor:"text-green-500"})),{success:!0,user:r.payload};{const t=r.payload?.result||"로그인에 실패했습니다.";return e(o.showToast({title:"로그인 실패",content:t,headerTextColor:"text-red-500"})),{success:!1,error:t}}}),[e,s]),u=t.useCallback(async()=>s(async()=>{const t=await e(i.logout());if(i.logout.fulfilled.match(t))return e(o.showToast({title:"로그아웃 완료",content:"안전하게 로그아웃되었습니다.",headerTextColor:"text-blue-500"})),l.push("/"),{success:!0};{const r=t.payload?.result||"로그아웃에 실패했습니다.";return e(o.showToast({title:"로그아웃 실패",content:r,headerTextColor:"text-red-500"})),{success:!1,error:r}}}),[e,s,l]),d=t.useCallback(async()=>{try{n("인증 정보를 확인하는 중입니다...");const t=await e(i.autoLogin());return i.autoLogin.fulfilled.match(t)?{success:!0,user:t.payload}:{success:!1,error:t.payload?.result}}finally{a()}},[e,n,a]),m=t.useCallback(async()=>{try{const{getCurrentUserFromToken:e,isTokenExpired:t}=await import("@util/jwtUtil"),r=await e();return r?t(r)?{valid:!1,reason:"EXPIRED"}:{valid:!0,user:r}:{valid:!1,reason:"NO_TOKEN"}}catch(e){return console.error("세션 확인 실패:",e),{valid:!1,reason:"ERROR"}}},[]),p=t.useCallback(async(t,r,s)=>{const n=await m();return n.valid?s&&n.user&&!n.user.is_admin?(e(o.showToast({title:"권한 부족",content:"관리자만 접근할 수 있습니다.",headerTextColor:"text-red-500"})),!1):(l.push(t),!0):(e(o.showToast({title:"로그인 필요",content:"로그인이 필요한 서비스입니다.",headerTextColor:"text-orange-500"})),!1)},[m,e,l]);return{userState:r,isLoggedIn:r.isLoggedIn,user:r.userInfo,error:r.error,loginWithLoader:c,logoutWithLoader:u,initializeAuth:d,checkSession:m,navigateWithAuth:p,isAdmin:()=>("admin"===r.userInfo?.permissionType||"super_admin"===r.userInfo?.permissionType)&&(r.userInfo?.level??0)>=99,isUser:()=>r.isLoggedIn&&r.userInfo}},exports.useAuthGuard=(e={})=>{const r=et(i.selectUserInfo),{userInfo:s,isLoggedIn:n}=r,[a,o]=t.useState(!0),[c,u]=t.useState(null),[d,m]=t.useState(null),p=t.useRef(!1),h=t.useRef(null),g=t.useCallback(async()=>{try{const{validateAndCleanToken:e}=await import("@util/jwtUtil"),t=await e();if(!t)return u("LOGIN_REQUIRED"),!1;const r=JSON.stringify(t);return h.current!==r&&(h.current=r,m(t)),!0}catch(e){console.error("토큰 인증 확인 실패:",e),u("TOKEN_INVALID");const{removeExpiredTokenFromCookie:t}=await import("@util/jwtUtil");return t(),!1}},[]),f=t.useCallback(t=>{if(e.adminOnly&&!l.isAdmin(t))return u("ADMIN_ONLY"),!1;if(void 0!==e.requiredLevel&&!l.hasLevelPermission(t,e.requiredLevel))return u("INSUFFICIENT_PERMISSION"),!1;if(e.boardPermissions){const r=e.boardPermissions.writeLevel,s=e.boardPermissions.readLevel;if(void 0!==r&&!l.hasBoardPermission(t,r,!0))return u("INSUFFICIENT_PERMISSION"),!1;if(void 0!==s&&!l.hasBoardPermission(t,s,!0))return u("INSUFFICIENT_PERMISSION"),!1}return!0},[e.adminOnly,e.requiredLevel,e.boardPermissions]),y=t.useCallback(async()=>{if(p.current)return!1;p.current=!0,o(!0),u(null);try{if(n&&s){return f(s)}if(!await g())return!1;if(!d)return u("LOGIN_REQUIRED"),!1;console.warn("Redux store에 사용자 정보가 없어 JWT 토큰 정보로 권한 체크를 수행합니다.");return f(d)}catch(e){return console.error("권한 체크 실패:",e),u("TOKEN_INVALID"),!1}finally{o(!1),p.current=!1}},[g,f,n,s,d]);t.useEffect(()=>{y()},[]),t.useEffect(()=>{if(n&&s&&!p.current){f(s)?(o(!1),u(null)):o(!1)}},[n,s,f]);const x=s||d,b=n&&!!x;return{isAuthenticated:b,hasPermission:b&&!c,isLoading:a,user:x,errorType:c,checkPermissionAsync:y}},exports.useBoardQuery=e=>d.useQuery({queryKey:["boards"],queryFn:()=>Te.getBoards(),staleTime:36e5,gcTime:864e5,retry:3,enabled:e?.enabled,select:e=>"N"!==e.successOrNot&&e.data?e:{...e,data:[]}}),exports.useCommentQuery=(e,t)=>d.useQuery({queryKey:["comments",e],queryFn:()=>p.getComments(e),staleTime:3e5,gcTime:18e5,retry:2,enabled:t?.enabled??!0,select:e=>{if("N"===e.successOrNot)return{data:{items:[],totalCount:0}};if(!e.data)return{data:{items:[],totalCount:0}};return{data:{items:Array.isArray(e.data.items)?e.data.items.map(e=>({...e,created_at:m.timeAgo(e.created_at)})):[],totalCount:e.data.totalCount||0}}}}),exports.useDeviceType=()=>{const e=Ge(),r=Qe(e=>e.app.deviceType);t.useEffect(()=>{const t=()=>{e(s.updateDeviceTypeFromWidth(window.innerWidth))};return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e]);return{deviceType:r,isMobile:"mobile"===r,isTablet:"tablet"===r,isDesktop:"desktop"===r,isMobileOrTablet:"mobile"===r||"tablet"===r}},exports.useDraftPostQuery=(e={},t={enabled:!0,enablePolling:!1})=>d.useQuery({queryKey:["draftPost",e],queryFn:()=>Ne.getDraftPosts(e),staleTime:0,gcTime:3e5,retry:3,enabled:t?.enabled,refetchInterval:e=>{if(!t?.enablePolling)return!1;const r=e.state.data;if(r&&r.data&&Array.isArray(r.data)){if(r.data.every(e=>!e.attachments||0===e.attachments.length||e.attachments.every(e=>"uploaded"===e.status)))return console.log("✅ 모든 파일 업로드가 완료되어 폴링을 중지합니다."),!1}return 2e3},refetchIntervalInBackground:!1,select:e=>"N"===e.successOrNot?{data:{items:[],totalCount:0,notices:[]}}:e.data?{data:{items:e.data.items.map(e=>({...e,created_at:m.timeAgo(e.created_at||(new Date).toISOString())})),totalCount:e.data.totalCount,notices:e.data.notices}}:{data:{items:[],totalCount:0,notices:[]}}}),exports.useGlobalLoader=Ye,exports.usePermission=()=>{const e=Ze(),r=et(i.selectUserInfo),s=r?.userInfo,[n,a]=t.useState(null),u=s||n,d=l.getUserLevel(u),m=l.isAdmin(u),p=r?.isLoggedIn||!!n;t.useEffect(()=>{(async()=>{if(s)a(null);else try{const e=await c.getCurrentUserFromToken();a(e)}catch(e){a(null)}})()},[s]);return{checkPermission:t.useCallback(e=>void 0===e||(s?l.hasLevelPermission(s,e):n?(console.warn("Redux store에 사용자 정보가 없어 JWT 토큰 정보를 사용합니다."),l.hasLevelPermission(n,e)):0===e),[s,n]),showAccessDeniedToast:t.useCallback(()=>{e(o.showToast({title:"접근 권한이 없습니다.",content:"해당 메뉴에 접근할 권한이 없습니다.",headerTextColor:"text-red-500"}))},[e]),userLevel:d,isAdmin:m,isLoggedIn:p,currentUser:u}},exports.usePostBookmarkQuery=()=>d.useQuery({queryKey:["postBookmark"],queryFn:()=>Ne.getBookmarkPosts(),staleTime:3e4,gcTime:864e5,retry:3,select:e=>"N"===e.successOrNot?{data:[]}:e.data}),exports.usePostQuery=(e,t)=>d.useQuery({queryKey:["post",e],queryFn:()=>Ne.getPost(e),staleTime:1e4,gcTime:864e5,retry:3,enabled:t?.enabled,placeholderData:e=>e,refetchOnMount:!1,select:e=>"N"===e.successOrNot?{data:{items:[],totalCount:0,notices:[]}}:e.data?{data:{items:e.data.items.map(e=>({...e,created_at:m.timeAgo(e.created_at||(new Date).toISOString())})),totalCount:e.data.totalCount,notices:e.data.notices}}:{data:{items:[],totalCount:0,notices:[]}}}),exports.useRouterWithLoader=Xe,exports.useUserPointHistoryQuery=e=>d.useQuery({queryKey:["userPointHistory",e],queryFn:()=>u.getUserPointHistory(e)}),exports.useUserPointQuery=e=>d.useQuery({queryKey:["userPoint",e],queryFn:()=>u.getUserPoint(e),staleTime:18e4,gcTime:36e5,retry:3,select:e=>{if("Y"===e.successOrNot&&e.data)return e.data;throw new Error("Failed to fetch user point")}}),exports.userService=ke;
//# sourceMappingURL=index.js.map
